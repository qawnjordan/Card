<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø·Ù„Ø¨ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±ØµÙŠØ¯ â€” Ù†Ù…ÙˆØ°Ø¬ Ø¢Ù…Ù†/Ù…Ø­Ù„ÙŠ (Ø¹Ø±Ø¶ ØªÙˆØ¶ÙŠØ­ÙŠ)</title>
<meta name="description" content="Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±ØµÙŠØ¯ â€” Ø¹Ø±Ø¶ Ù…Ø­Ù„ÙŠØŒ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ ØªØ®Ø²ÙŠÙ† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª." />

<style>
/* ===============================
   Variables & Reset
   =============================== */
:root{
  --bg:#f6f8fc;
  --card-grad-1: linear-gradient(135deg,#0b1c2d,#102a43);
  --accent:#38bdf8;
  --accent-2:#2563eb;
  --gold:#facc15;
  --muted:#64748b;
  --text:#0f172a;
  --surface:#fff;
  --success:#10b981;
  --danger:#ef4444;
  --shadow:0 20px 50px rgba(2,8,23,.12);
  --glass: rgba(255,255,255,.6);
  --radius:18px;
  --glass-2: rgba(255,255,255,.04);
  --focus: 0 6px 20px rgba(56,189,248,.16);
  font-family: Inter, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans Arabic", sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* basic reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  direction:rtl;
  padding:20px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  min-height:100vh;
}

/* App container */
.app{
  width:100%;
  max-width:540px;
  margin:12px;
  padding:18px;
  background:transparent;
}

/* header / hero */
.hero{
  background:var(--card-grad-1);
  color:white;
  border-radius:22px;
  padding:18px;
  box-shadow:var(--shadow);
  position:relative;
  overflow:hidden;
}
.hero small{
  background:rgba(255,255,255,.08);
  color:rgba(255,255,255,.9);
  padding:6px 12px;
  border-radius:999px;
  font-weight:700;
  font-size:12px;
}
.hero h1{font-size:20px;margin:12px 0 4px;font-weight:800}
.hero .amount{
  font-size:34px;
  font-weight:900;
  color:var(--gold);
}

/* trust bar */
.trust-bar{
  display:flex;
  gap:8px;
  margin:14px 0;
}
.trust{
  flex:1;
  background:var(--surface);
  border-radius:12px;
  padding:10px;
  font-size:12px;
  text-align:center;
  color:var(--muted);
  border:1px solid #e6eef8;
  box-shadow:0 6px 18px rgba(2,8,23,.03);
}

/* card preview (front/back flip) */
.card-wrap{
  perspective:1000px;
  margin:18px 0;
}
.card{
  width:100%;
  border-radius:18px;
  min-height:160px;
  transform-style:preserve-3d;
  transition:transform .7s cubic-bezier(.2,.9,.3,1);
  position:relative;
}
.card.is-flipped{transform:rotateY(180deg)}
.card-face{
  position:relative;
  backface-visibility:hidden;
  border-radius:18px;
  padding:18px;
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  box-shadow:var(--shadow);
  min-height:160px;
}
.card-front{
  background:linear-gradient(135deg,#1e3a8a,#2563eb);
}
.card-back{
  background:linear-gradient(135deg,#0f172a,#0b1c2d);
  transform:rotateY(180deg);
}

/* front layout */
.card-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:13px;
  opacity:.95;
}
.brand{
  display:flex;
  gap:8px;
  align-items:center;
  font-weight:800;
  font-size:13px;
  text-transform:uppercase;
}
.brand .logo{
  width:38px;height:24px;border-radius:6px;background:linear-gradient(90deg,#fff8cc,#ffd166);display:flex;align-items:center;justify-content:center;font-weight:800;color:#1e293b;font-size:12px;
}
.chip{
  width:44px;height:28px;border-radius:6px;background:linear-gradient(135deg,#fde68a,#facc15);
}
.card-number{
  font-size:20px;
  font-weight:700;
  letter-spacing:2px;
  direction:ltr;
  text-align:left;
}
.card-meta{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  gap:10px;
}
.small-muted{color:rgba(255,255,255,.85);font-weight:600}

/* back layout */
.back-strip{
  height:44px;
  background:#000;
  opacity:.9;
  border-radius:8px;
  margin-top:8px;
}
.cvv-box{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-start;
  margin-top:12px;
}
.cvv-field{
  background:rgba(255,255,255,.12);
  color:#fff;
  padding:8px 12px;
  border-radius:8px;
  font-weight:700;
  letter-spacing:2px;
}

/* form section */
.section{
  background:var(--surface);
  border-radius:18px;
  padding:16px;
  box-shadow:var(--shadow);
  margin-top:14px;
}
.form-row{display:flex;gap:10px;margin-top:12px;align-items:flex-start}
.input{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid #e6eef8;
  font-size:15px;
  transition:box-shadow .18s,transform .18s,border-color .18s;
  background:transparent;
  outline:none;
}
.input:focus{
  box-shadow:var(--focus);
  border-color:var(--accent);
  transform:translateY(-1px);
}
.label{font-size:12px;color:var(--muted);margin-bottom:8px;font-weight:700}

/* special styles for card-number input area */
.cc-group{display:flex;gap:8px;align-items:center}
.cc-input{font-family:monospace;letter-spacing:2px}

/* helper / hint / error */
.hint{font-size:12px;color:var(--muted);margin-top:8px}
.error{font-size:13px;color:var(--danger);margin-top:8px;display:none}
.error[aria-hidden="false"]{display:block}

/* sticky submit */
.actions{
  position:sticky;
  bottom:14px;
  margin-top:14px;
  background:transparent;
  padding-top:8px;
}
.btn{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background:linear-gradient(90deg,var(--accent-2),var(--accent));
  color:white;
  font-weight:900;
  font-size:16px;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(37,99,235,.18);
}
.btn:disabled{opacity:.5;cursor:not-allowed}
.meta-footer{font-size:12px;color:var(--muted);text-align:center;margin-top:12px}

/* small controls */
.controls{display:flex;gap:8px;align-items:center}
.small-btn{padding:8px 10px;border-radius:10px;border:1px solid #eef5ff;background:transparent;font-weight:700;cursor:pointer}

/* success toast */
.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:28px;
  background:linear-gradient(90deg,#10b981,#06b6d4);
  color:white;padding:12px 18px;border-radius:12px;box-shadow:0 14px 40px rgba(2,8,23,.18);display:none;font-weight:700;
}
.toast.show{display:block;animation:pop .36s ease}

@keyframes pop{0%{transform:translateX(-50%) translateY(18px) scale(.98);opacity:0}100%{transform:translateX(-50%) translateY(0) scale(1);opacity:1}}

/* responsive */
@media (max-width:520px){
  .card-number{font-size:18px}
  .hero .amount{font-size:28px}
}

/* accessibility focus visible */
:focus{outline:none}
:focus-visible{box-shadow:0 0 0 3px rgba(56,189,248,.16)}
</style>
</head>
<body>

<main class="app" aria-labelledby="pageTitle">
  <!-- HERO -->
  <header class="hero" role="banner">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <small>Ø·Ù„Ø¨ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±Ø³Ù…ÙŠ</small>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="themeToggle" class="small-btn" aria-pressed="false" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</button>
        <button id="copyMock" class="small-btn" title="Ù†Ø³Ø® Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ">Ù†Ø³Ø® Ø±Ù‚Ù…ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
      </div>
    </div>
    <h1 id="pageTitle">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø§Ù„ÙŠ</h1>
    <div class="amount" aria-hidden="false">100 Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ</div>
  </header>

  <!-- TRUST -->
  <div class="trust-bar" aria-hidden="false" style="margin-top:12px">
    <div class="trust">ğŸ”’ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
    <div class="trust">ğŸ›¡ï¸ ØªØ­Ù‚Ù‚ Ù…Ø­Ù„ÙŠ</div>
    <div class="trust">âš–ï¸ Ù…ØªÙˆØ§ÙÙ‚</div>
  </div>

  <!-- CARD PREVIEW (flip when focusing CVV) -->
  <section class="card-wrap" aria-hidden="false">
    <div id="card" class="card" aria-hidden="false" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
      <!-- FRONT -->
      <div class="card-face card-front" id="cardFront">
        <div class="card-top">
          <div class="chip" aria-hidden="true"></div>
          <div class="brand" id="brandLabel" aria-hidden="false">
            <div class="logo" id="brandLogo">â€”</div>
            <div id="brandName" style="font-size:13px;opacity:.95">â€”</div>
          </div>
        </div>

        <div class="card-number" id="cardView" aria-live="polite" aria-atomic="true">0000 0000 0000 0000</div>

        <div class="card-meta">
          <div>
            <div style="font-size:11px;opacity:.9">Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
            <div class="small-muted" id="ownerView">Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§</div>
          </div>
          <div style="text-align:left">
            <div style="font-size:11px;opacity:.9">Ø§Ù†ØªÙ‡Ø§Ø¡</div>
            <div class="small-muted" id="dateView">MM/YY</div>
          </div>
        </div>
      </div>

      <!-- BACK -->
      <div class="card-face card-back" id="cardBack" aria-hidden="true" aria-label="Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
        <div class="back-strip" aria-hidden="true"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div style="flex:1">
            <div style="font-size:11px;color:rgba(255,255,255,.85)">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</div>
            <div style="background:#fff;color:#111;padding:6px 8px;border-radius:6px;margin-top:6px;font-weight:700">-- ØªÙˆÙ‚ÙŠØ¹ --</div>
          </div>
          <div style="min-width:84px;text-align:left">
            <div style="font-size:11px;color:rgba(255,255,255,.85);text-align:left">CVV</div>
            <div class="cvv-field" id="cvvView" aria-live="polite">***</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FORM -->
  <form id="eligibilityForm" class="section" novalidate aria-describedby="formNote" autocomplete="off">
    <!-- Note: This is a local demo. No data is sent or stored. -->
    <p id="formNote" class="hint"><strong>ØªÙ†ÙˆÙŠÙ‡:</strong> Ù‡Ø°Ø§ Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ ØªÙˆØ¶ÙŠØ­ÙŠ Ù…Ø­Ù„ÙŠ ÙÙ‚Ø· â€” Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ ØªØ®Ø²ÙŠÙ† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª.</p>

    <!-- Card number (single smart input) -->
    <div style="margin-top:10px">
      <label for="cardNumber" class="label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
      <div class="cc-group" role="group" aria-labelledby="cardNumber">
        <input id="cardNumber" class="input cc-input" type="text" inputmode="numeric"
               placeholder="0000 0000 0000 0000" maxlength="19" aria-describedby="cardHelp" autocomplete="cc-number"
               name="cc-number" aria-label="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
        <button type="button" id="pasteBtn" class="small-btn" title="Ù„ØµÙ‚">Ù„ØµÙ‚</button>
      </div>
      <div id="cardHelp" class="hint">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø±Ù‚Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø±ÙŠØ© ÙÙ‚Ø·. ÙŠØ¯Ø¹Ù… Ù„ØµÙ‚ Ø±Ù‚Ù… ÙƒØ§Ù…Ù„. (VISA, MasterCard, Amex)</div>
      <div id="cardError" class="error" role="alert" aria-hidden="true"></div>
    </div>

    <!-- Name + Expiry + CVV -->
    <div class="form-row" style="margin-top:12px">
      <div style="flex:1">
        <label for="owner" class="label">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
        <input id="owner" class="input" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" autocomplete="cc-name" name="cc-name" />
      </div>
    </div>

    <div class="form-row">
      <div style="width:48%">
        <label for="exp" class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (MM/YY)</label>
        <input id="exp" class="input" inputmode="numeric" maxlength="5" placeholder="MM/YY" autocomplete="cc-exp" name="cc-exp" />
        <div id="expError" class="error" role="alert" aria-hidden="true"></div>
      </div>

      <div style="width:48%">
        <label for="cvv" class="label">CVV</label>
        <input id="cvv" class="input" inputmode="numeric" maxlength="4" placeholder="***" autocomplete="cc-csc" name="cc-csc" />
        <div id="cvvError" class="error" role="alert" aria-hidden="true"></div>
      </div>
    </div>

    <!-- actions -->
    <div class="actions">
      <button id="submitBtn" class="btn" type="submit" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</button>
      <div class="meta-footer" style="margin-top:10px">
        <span id="liveStatus" aria-live="polite"></span>
      </div>
    </div>
  </form>
</main>

<!-- toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/*
  Enhanced demo script:
  - Single smart card number input (supports paste of whole number).
  - Detect card brand (VISA, MasterCard, Amex) and adapt CVV length.
  - Luhn validation, expiry validation (not expired).
  - Card preview with flip animation when focusing CVV.
  - Accessibility: aria-live, role=alert for errors.
  - No network calls: simulated processing only.
  - Clipboard demo button adds an example test card to clipboard.
*/

/* Helpers */
const $ = sel => document.querySelector(sel);
const formatGroups = (digits, brand) => {
  // Amex: 4-6-5 (15), Diners sometimes 14, most others 4-4-4-4 (16)
  if(brand === 'amex'){
    const a = digits.slice(0,4);
    const b = digits.slice(4,10);
    const c = digits.slice(10,15);
    return [a,b,c].filter(Boolean).join(' ');
  } else {
    return digits.replace(/(.{4})/g,'$1 ').trim();
  }
};
const onlyDigits = s => (s||'').replace(/\D/g,'');
const todayYMD = () => {
  const d=new Date();
  return {y:d.getFullYear(),m:d.getMonth()+1};
};

/* Luhn algorithm */
function luhn(num){
  num = String(num).replace(/\D/g,'');
  let sum=0, alt=false;
  for(let i=num.length-1;i>=0;i--){
    let n=parseInt(num[i],10);
    if(alt){
      n*=2;
      if(n>9) n-=9;
    }
    sum += n;
    alt = !alt;
  }
  return (sum % 10) === 0;
}

/* Card brand detection (simple BIN-based) */
function detectBrand(digits){
  if(!digits) return null;
  if(/^4/.test(digits)) return 'visa';
  if(/^5[1-5]/.test(digits) || /^2(2[2-9]|[3-6]\d|7[01])/.test(digits)) return 'mastercard';
  if(/^3[47]/.test(digits)) return 'amex';
  if(/^6(011|5)/.test(digits) || /^64[4-9]/.test(digits)) return 'discover';
  return 'unknown';
}

/* DOM elements */
const cardNumber = $('#cardNumber');
const brandLogo = $('#brandLogo');
const brandName = $('#brandName');
const cardView = $('#cardView');
const ownerInput = $('#owner');
const ownerView = $('#ownerView');
const expInput = $('#exp');
const dateView = $('#dateView');
const cvvInput = $('#cvv');
const cvvView = $('#cvvView');
const cardEl = $('#card');
const cardFront = $('#cardFront');
const cardBack = $('#cardBack');
const cardError = $('#cardError');
const expError = $('#expError');
const cvvError = $('#cvvError');
const submitBtn = $('#submitBtn');
const toast = $('#toast');
const liveStatus = $('#liveStatus');
const pasteBtn = $('#pasteBtn');
const themeToggle = $('#themeToggle');
const copyMock = $('#copyMock');

/* State */
let state = {
  digits: '',
  brand: null,
  valid: false
};

/* Update visual brand */
function renderBrand(brand){
  brandName.textContent = brand ? brand.toUpperCase() : 'â€”';
  brandLogo.textContent = brand === 'visa' ? 'V' : brand === 'mastercard' ? 'M' : brand === 'amex' ? 'AM' : 'â€”';
}

/* Update full preview */
function render(){
  const d = onlyDigits(cardNumber.value);
  const brand = detectBrand(d);
  state.digits = d;
  state.brand = brand;
  renderBrand(brand);
  // formatting
  cardView.textContent = d.length ? formatGroups(d, brand) : '0000 0000 0000 0000';
  // owner display
  ownerView.textContent = ownerInput.value || 'Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§';
  // date
  dateView.textContent = expInput.value || 'MM/YY';
  // cvv preview masked
  const cv = onlyDigits(cvvInput.value);
  cvvView.textContent = cv ? '*'.repeat(cv.length) : '***';

  // adapt CVV maxlength for Amex
  if(brand === 'amex'){
    cvvInput.maxLength = 4;
    cvvInput.placeholder = '####';
  } else {
    cvvInput.maxLength = 3;
    cvvInput.placeholder = '***';
  }

  // validation & enable submit
  validateAll();
}

/* Validation functions */
function validateCardNumber(){
  const d = state.digits;
  if(!d) {
    cardError.setAttribute('aria-hidden','true'); cardError.textContent=''; return false;
  }
  // Accept 13..19 but commonly 15 (amex) or 16
  const brand = state.brand;
  const len = d.length;
  const okLen = (brand === 'amex' && len===15) || (brand !== 'amex' && (len>=13 && len<=19));
  if(!okLen){
    cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'Ø·ÙˆÙ„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ§Ù„Ø­.';
    return false;
  }
  if(!luhn(d)){
    cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'ØªØ­Ù‚Ù‚ Luhn ÙØ´Ù„ â€” Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.';
    return false;
  }
  cardError.setAttribute('aria-hidden','true'); cardError.textContent='';
  return true;
}

function validateExpiry(){
  const v = expInput.value.trim();
  expError.setAttribute('aria-hidden','true'); expError.textContent='';
  if(!v) return false;
  if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(v)){
    expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† MM/YY';
    return false;
  }
  const [mm,yy] = v.split('/');
  const year = 2000 + parseInt(yy,10);
  const month = parseInt(mm,10);
  const {y,m} = todayYMD();
  const now = new Date(y,m,1);
  const expDate = new Date(year,month,1);
  if(expDate <= now){
    expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.';
    return false;
  }
  expError.setAttribute('aria-hidden','true'); expError.textContent='';
  return true;
}

function validateCVV(){
  const cv = onlyDigits(cvvInput.value);
  const brand = state.brand;
  if(!cv){
    cvvError.setAttribute('aria-hidden','true'); cvvError.textContent=''; return false;
  }
  if(brand === 'amex'){
    if(cv.length !== 4){ cvvError.setAttribute('aria-hidden','false'); cvvError.textContent='Ø±Ù…Ø² Amex ÙŠØªÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù….'; return false; }
  } else {
    if(cv.length !==3){ cvvError.setAttribute('aria-hidden','false'); cvvError.textContent='CVV ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 3 Ø£Ø±Ù‚Ø§Ù….'; return false; }
  }
  cvvError.setAttribute('aria-hidden','true'); cvvError.textContent='';
  return true;
}

/* Combined */
function validateAll(){
  const c = validateCardNumber();
  const e = validateExpiry();
  const v = validateCVV();
  const all = c && e && v;
  submitBtn.disabled = !all;
  state.valid = all;
  liveStatus.textContent = all ? 'Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„' : 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©';
  return all;
}

/* Input handling (formatting) */
cardNumber.addEventListener('input', e=>{
  const prev = e.target.selectionStart;
  let digits = onlyDigits(e.target.value).slice(0,19);
  // auto detect brand to format groups
  const brand = detectBrand(digits);
  const formatted = formatGroups(digits, brand);
  e.target.value = formatted;
  render();
  // attempt to restore caret near previous pos (simple)
  // place cursor at end for simplicity for demo
  e.target.setSelectionRange(e.target.value.length, e.target.value.length);
});

cardNumber.addEventListener('paste', e=>{
  e.preventDefault();
  const txt = (e.clipboardData || window.clipboardData).getData('text');
  const digits = onlyDigits(txt).slice(0,19);
  if(!digits) return;
  cardNumber.value = formatGroups(digits, detectBrand(digits));
  render();
});

pasteBtn.addEventListener('click', async ()=>{
  // Try read from clipboard and paste
  try{
    const txt = await navigator.clipboard.readText();
    const digits = onlyDigits(txt).slice(0,19);
    if(!digits){ showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø§ÙØ¸Ø©'); return; }
    cardNumber.value = formatGroups(digits, detectBrand(digits));
    render();
    showToast('ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©');
  }catch(err){
    showToast('ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©'); console.error(err);
  }
});

/* expiry formatting MM/YY */
expInput.addEventListener('input', e=>{
  let v = onlyDigits(e.target.value).slice(0,4);
  if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2);
  e.target.value = v;
  render();
});

/* owner */
ownerInput.addEventListener('input', render);

/* CVV behavior */
cvvInput.addEventListener('input', e=>{
  e.target.value = onlyDigits(e.target.value).slice(0,4);
  render();
});

/* flip card when focusing CVV */
cvvInput.addEventListener('focus', ()=>{
  cardEl.classList.add('is-flipped');
  cardBack.setAttribute('aria-hidden','false');
  cardFront.setAttribute('aria-hidden','true');
});
cvvInput.addEventListener('blur', ()=>{
  cardEl.classList.remove('is-flipped');
  cardBack.setAttribute('aria-hidden','true');
  cardFront.setAttribute('aria-hidden','false');
});

/* simple simulated submit */
document.getElementById('eligibilityForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!validateAll()) { showToast('ØªÙƒÙ…Ù„Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.'); return; }
  submitBtn.disabled = true;
  submitBtn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...';
  // Simulate processing delay
  await new Promise(r=>setTimeout(r,1100));
  // Provide simulated result (always success in demo)
  showToast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© â€” Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª', 3200);
  submitBtn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚';
  submitBtn.disabled = false;
  // For demo, do a small success highlight
  cardEl.style.boxShadow = '0 30px 70px rgba(16,185,129,.14)';
  setTimeout(()=>cardEl.style.boxShadow='',1200);
});

/* Live render on load */
render();

/* show toast */
function showToast(msg, ms=1600){
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'), ms);
}

/* Mock copy of test card numbers */
copyMock.addEventListener('click', async ()=>{
  // Example test numbers (never real) - helpful for demo
  const examples = {
    visa: '4111 1111 1111 1111',
    mc: '5555 5555 5555 4444',
    amex: '3782 822463 10005'
  };
  try{
    await navigator.clipboard.writeText(examples.visa);
    showToast('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ (VISA) Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
  }catch(e){
    showToast('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø­Ø§ÙØ¸Ø©');
  }
});

/* Theme toggle â€” for demo (light/dark) */
themeToggle.addEventListener('click', ()=>{
  const pressed = themeToggle.getAttribute('aria-pressed') === 'true';
  themeToggle.setAttribute('aria-pressed', String(!pressed));
  if(!pressed){
    document.documentElement.style.setProperty('--card-grad-1','linear-gradient(135deg,#07103a,#082b4a)');
    document.body.style.background = 'linear-gradient(180deg,#0b1220 0%, #071528 100%)';
    themeToggle.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
  } else {
    document.documentElement.style.removeProperty('--card-grad-1');
    document.body.style.removeProperty('background');
    themeToggle.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†';
  }
});

/* keyboard accessibility / enter to submit when valid */
[cardNumber, expInput, cvvInput, ownerInput].forEach(el=>{
  el.addEventListener('keydown', (ev)=>{
    if(ev.key === 'Enter'){
      ev.preventDefault();
      if(state.valid){
        $('#eligibilityForm').dispatchEvent(new Event('submit', {cancelable:true}));
      }
    }
  });
});

/* initial accessibility state */
cardError.setAttribute('aria-hidden','true');
expError.setAttribute('aria-hidden','true');
cvvError.setAttribute('aria-hidden','true');

/* Prevent accidental navigation with dirty form (demo) */
let isDirty = false;
['input','change'].forEach(evt=>{
  document.getElementById('eligibilityForm').addEventListener(evt, ()=>{ isDirty = true; });
});
window.addEventListener('beforeunload', (e)=>{
  if(isDirty){
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>

</body>
</html>