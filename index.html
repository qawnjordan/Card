<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø§Ù„ÙŠ â€” Ø¨Ù‚ÙŠÙ…Ø© 100 Ø¯ÙŠÙ†Ø§Ø±</title>
<meta name="description" content="Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±ØµÙŠØ¯ â€” ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Ù†Ù‚Ù„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ØªØµÙØ­." />
<link rel="icon" href="data:,">

<style>
:root{
  --surface:#ffffff;
  --accent:#06b6d4;
  --accent-2:#3b82f6;
  --muted:#94a3b8;
  --text:#0f172a;
  --shadow:0 18px 50px rgba(2,8,23,.18);
  --radius:12px;
  font-family: Inter, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans Arabic", sans-serif;
}

/* reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:linear-gradient(180deg,#eef2ff 0%, #f8fafc 100%);
  color:var(--text);
  direction:rtl;
  padding:12px;
  display:flex;
  justify-content:center;
  min-height:100vh;
}

/* app container */
.app{
  width:100%;
  max-width:980px;
  padding:12px;
}

/* hero */
.hero{
  background:linear-gradient(135deg,#0b1c2d,#0f172a);
  color:white;
  border-radius:14px;
  padding:10px 12px;
  box-shadow:var(--shadow);
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.brand-badge{ width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffd166,#ffb703);display:flex;align-items:center;justify-content:center;font-weight:900;color:#05203a;font-size:18px }
.hero h1{font-size:15px;margin:0;font-weight:800}

/* trust */
.trust-bar{ display:flex; gap:8px; margin:10px 0; align-items:center; }
.trust{ flex:1; background:var(--surface); border-radius:10px; padding:8px; font-size:13px; color:var(--muted); border:1px solid #eef6ff; box-shadow:0 8px 20px rgba(2,8,23,.04); }

/* MAIN: use flex for tight side-by-side */
.main-grid{
  display:flex;
  gap:6px;              /* very small gap */
  align-items:flex-start;
  margin-top:8px;
}

/* Card column: make it narrow and allow slight overlap if needed */
.card-wrap{
  flex: 0 0 40%;       /* 40% width for card preview */
  margin:0;
  position:relative;
}

/* Optional stronger "glue" â€” uncomment to overlap slightly */
// .card-wrap{ margin-inline-start:-16px; }

.card{
  width:100%;
  border-radius:var(--radius);
  min-height:160px;
  position:relative;
  overflow:hidden;
  transition:box-shadow .2s ease;
  padding:0;
}
.card-face{
  padding:12px;
  color:#fff;
  min-height:160px;
  border-radius:var(--radius);
  position:relative;
  background:linear-gradient(135deg,#1e3a8a,#2563eb);
  box-shadow:var(--shadow);
}

/* card content */
.card-top{ display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:12px; padding:6px; }
.brand{ display:flex; gap:8px; align-items:center; font-weight:800; text-transform:uppercase; }
.logo{ width:44px;height:28px;border-radius:8px;background:linear-gradient(90deg,#fff8cc,#ffd166);display:flex;align-items:center;justify-content:center;color:#05203a;font-weight:800; font-size:12px; }
.chip{ width:40px;height:24px;border-radius:6px;background:linear-gradient(135deg,#fde68a,#facc15); }

.card-number{
  font-size:18px;
  font-weight:800;
  letter-spacing:2px;
  direction:ltr;
  text-align:left;
  margin:6px 12px;
}

/* meta row */
.card-meta{ display:flex; justify-content:space-between; align-items:center; gap:8px; padding:0 12px 12px 12px; font-size:11px; }
.small-muted{ color:rgba(255,255,255,.95); font-weight:700; }

/* FRONT CVV (now visible on front near bottom-right) */
.card-cvv-front{
  position:absolute;
  bottom:18px;
  left:18px; /* left because card content uses LTR oriented number area on left; in rtl layout card itself is visually right column */
  background:rgba(255,255,255,.10);
  padding:6px 10px;
  border-radius:8px;
  font-weight:800;
  letter-spacing:2px;
  color:#fff;
  font-size:13px;
  min-width:54px;
  text-align:center;
  backdrop-filter: blur(2px);
}

/* form column: compact to sit next to card */
.form-column{
  flex:1;
  margin:0;
}
.section{
  background:var(--surface);
  border-radius:10px;
  padding:10px;
  box-shadow:0 10px 30px rgba(2,8,23,.06);
}

/* inputs */
.label{ font-size:13px; color:var(--muted); margin-bottom:6px; display:block; font-weight:700 }
.input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6eef8; font-size:14px; background:transparent; outline:none; transition:box-shadow .14s; }
.input:focus{ box-shadow:0 8px 30px rgba(37,99,235,.08); border-color:var(--accent); transform:translateY(-1px); }

/* helper / hint / error */
.hint{ font-size:13px; color:var(--muted) }
.error{ font-size:13px; color:#ef4444; margin-top:8px; display:none }
.error[aria-hidden="false"]{ display:block }

/* actions */
.actions{ margin-top:12px; position:sticky; bottom:8px; }
.btn{ width:100%; padding:12px; border-radius:10px; border:none; background:linear-gradient(90deg,var(--accent-2),var(--accent)); color:white; font-weight:900; font-size:15px; cursor:pointer; box-shadow:0 8px 26px rgba(37,99,235,.14)}
.btn:disabled{ opacity:.6; cursor:not-allowed }

/* small screens: stack */
@media (max-width:900px){
  .main-grid{ flex-direction:column; gap:10px; }
  .card-wrap{ flex: none; width:100%; }
  .form-column{ width:100%; }
  .card-cvv-front{ left:12px; bottom:12px; }
}
</style>
</head>
<body>

<main class="app" aria-labelledby="pageTitle">
  <header class="hero" role="banner">
    <div style="display:flex;gap:10px;align-items:center">
      <div class="brand-badge" aria-hidden="true">ğŸ’³</div>
      <h1 id="pageTitle">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯ Ù…Ø§Ù„ÙŠ â€” Ø¨Ù‚ÙŠÙ…Ø© 100 Ø¯ÙŠÙ†Ø§Ø±</h1>
    </div>
    <div aria-hidden="true"></div>
  </header>

  <div class="trust-bar" aria-hidden="false">
    <div class="trust">ğŸ”’ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ</div>
    <div class="trust">ğŸ›¡ï¸ ØªØ­Ù‚Ù‚ Ù…Ø­Ù„ÙŠ ÙÙˆØ±ÙŠ</div>
    <div class="trust">âš–ï¸ ØªØ¬Ø±Ø¨Ø© Ù…ØªÙˆØ§ÙÙ‚Ø©</div>
  </div>

  <div class="main-grid" aria-live="polite">
    <!-- CARD (right column visually due to RTL) -->
    <section class="card-wrap" aria-hidden="false">
      <div id="card" class="card" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
        <div class="card-face card-front" id="cardFront">
          <div class="card-top">
            <div style="display:flex;gap:8px;align-items:center">
              <div class="chip" aria-hidden="true"></div>
              <div class="brand" id="brandLabel" aria-hidden="false">
                <div class="logo" id="brandLogo">â€”</div>
                <div id="brandName" style="font-size:12px;opacity:.95">â€”</div>
              </div>
            </div>
            <div style="font-size:11px;opacity:.9">ØµØ§Ù„Ø­Ø© Ø­ØªÙ‰</div>
          </div>

          <div>
            <div class="card-number" id="cardView" aria-live="polite" aria-atomic="true">0000 0000 0000 0000</div>
            <div class="card-meta">
              <div>
                <div style="font-size:10px;opacity:.9">Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
                <div class="small-muted" id="ownerView">Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§</div>
              </div>
              <div style="text-align:left">
                <div style="font-size:10px;opacity:.9">Ø§Ù†ØªÙ‡Ø§Ø¡</div>
                <div class="small-muted" id="dateView">MM/YY</div>
              </div>
            </div>
          </div>

          <!-- CVV shown on front as requested -->
          <div class="card-cvv-front" id="cardCvvFront">***</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
        <button id="showNumberBtn" aria-pressed="true" class="icon-btn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">ğŸ™ˆ</button>
        <div style="flex:1" class="hint">Ø§Ù„Ø±Ù‚Ù… ÙˆCVV ÙŠØ¸Ù‡Ø±Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡Ù†Ø§. Ø§Ø¶ØºØ· Ø§Ù„Ø¹ÙŠÙ† Ù„Ø¥Ø®ÙØ§Ø¦Ù‡Ù…Ø§.</div>
      </div>
    </section>

    <!-- FORM (left column) -->
    <form id="eligibilityForm" class="form-column section" novalidate autocomplete="off">
      <div>
        <label for="cardNumber" class="label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="cardNumber" class="input" type="text" inputmode="numeric"
                 placeholder="0000 0000 0000 0000" maxlength="23" autocomplete="cc-number" name="cc-number" aria-label="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" />
          <button type="button" id="pasteBtn" class="small-btn" title="Ù„ØµÙ‚">Ù„ØµÙ‚</button>
        </div>
        <div id="cardError" class="error" role="alert" aria-hidden="true"></div>
      </div>

      <div style="margin-top:10px">
        <label for="owner" class="label">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
        <input id="owner" class="input" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" autocomplete="cc-name" name="cc-name" />
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;align-items:flex-start">
        <div style="flex:1">
          <label for="exp" class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (MM/YY)</label>
          <input id="exp" class="input" inputmode="numeric" maxlength="5" placeholder="MM/YY" autocomplete="cc-exp" name="cc-exp" />
          <div id="expError" class="error" role="alert" aria-hidden="true"></div>
        </div>

        <div style="width:40%">
          <label for="cvv" class="label">CVV</label>
          <input id="cvv" class="input" inputmode="numeric" maxlength="4" placeholder="***" autocomplete="cc-csc" name="cc-csc" />
          <div id="cvvError" class="error" role="alert" aria-hidden="true"></div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <input type="checkbox" id="persistToggle" />
        <label for="persistToggle" class="hint" style="margin:0">Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn" type="submit" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</button>
      </div>
    </form>
  </div>
</main>

<!-- toast -->
<div id="toast" role="status" aria-live="polite" style="display:none;position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:linear-gradient(90deg,#10b981,#06b6d4);color:white;padding:10px 14px;border-radius:10px;box-shadow:0 14px 40px rgba(2,8,23,.18);z-index:60;"></div>

<script>
/* helpers */
const $ = s => document.querySelector(s);
const onlyDigits = s => (s||'').replace(/\D/g,'');

/* DOM */
const cardNumber = $('#cardNumber');
const cardView = $('#cardView');
const ownerInput = $('#owner');
const ownerView = $('#ownerView');
const expInput = $('#exp');
const dateView = $('#dateView');
const cvvInput = $('#cvv');
const cardCvvFront = $('#cardCvvFront');
const brandLogo = $('#brandLogo');
const brandName = $('#brandName');
const cardError = $('#cardError');
const expError = $('#expError');
const cvvError = $('#cvvError');
const submitBtn = $('#submitBtn');
const pasteBtn = $('#pasteBtn');
const showNumberBtn = $('#showNumberBtn');
const toast = $('#toast');
const persistToggle = $('#persistToggle');

let state = { digits:'', brand:null, valid:false, showNumber:true, persist:false };

/* luhn */
function luhn(num){
  num = String(num).replace(/\D/g,'');
  let sum=0, alt=false;
  for(let i=num.length-1;i>=0;i--){
    let n=parseInt(num[i],10);
    if(alt){ n*=2; if(n>9) n-=9; }
    sum += n; alt = !alt;
  }
  return sum % 10 === 0;
}

/* brand detection & formatting */
function detectBrand(digits){
  if(!digits) return null;
  if(/^4/.test(digits)) return 'visa';
  if(/^5[1-5]/.test(digits) || /^2(2[2-9]|[3-6]\d|7[01])/.test(digits)) return 'mastercard';
  if(/^3[47]/.test(digits)) return 'amex';
  if(/^6(011|5)/.test(digits) || /^64[4-9]/.test(digits)) return 'discover';
  return 'unknown';
}
function formatGroups(digits, brand){
  if(!digits) return '';
  if(brand === 'amex'){
    const a = digits.slice(0,4), b = digits.slice(4,10), c = digits.slice(10,15);
    return [a,b,c].filter(Boolean).join(' ');
  } else {
    return digits.replace(/(.{4})/g,'$1 ').trim();
  }
}
const brandLabelMap = { visa:{name:'VISA',logo:'V'}, mastercard:{name:'MasterCard',logo:'M'}, amex:{name:'AMEX',logo:'AM'}, discover:{name:'Discover',logo:'D'}, unknown:{name:'â€”',logo:'â€”'} };

/* render */
function renderBrand(b){ const info = brandLabelMap[b] || brandLabelMap.unknown; if(brandLogo) brandLogo.textContent = info.logo; if(brandName) brandName.textContent = info.name; }
function render(){
  const d = onlyDigits(cardNumber.value);
  const brand = detectBrand(d);
  state.digits = d; state.brand = brand;
  renderBrand(brand);

  const formatted = d.length ? formatGroups(d,brand) : '0000 0000 0000 0000';
  cardView.textContent = d.length ? (state.showNumber ? formatted : formatted.replace(/\d/g,'â€¢')) : '0000 0000 0000 0000';
  ownerView.textContent = ownerInput.value || 'Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§';
  dateView.textContent = expInput.value || 'MM/YY';

  // CVV front
  const cv = onlyDigits(cvvInput.value);
  cardCvvFront.textContent = cv ? (state.showNumber ? cv : '*'.repeat(cv.length)) : '***';

  // CVV length for Amex
  if(brand === 'amex'){ cvvInput.maxLength = 4; cvvInput.placeholder = '####'; } else { cvvInput.maxLength = 3; cvvInput.placeholder = '***'; }

  validateAll();
}

/* validation */
function validateCardNumber(){
  const d = state.digits;
  if(!d){ cardError.setAttribute('aria-hidden','true'); cardError.textContent=''; return false; }
  const brand = state.brand; const len = d.length;
  const okLen = (brand === 'amex' && len===15) || (brand !== 'amex' && (len>=13 && len<=19));
  if(!okLen){ cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'Ø·ÙˆÙ„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ§Ù„Ø­.'; return false; }
  if(!luhn(d)){ cardError.setAttribute('aria-hidden','false'); cardError.textContent = 'ØªØ­Ù‚Ù‚ Luhn ÙØ´Ù„ â€” Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.'; return false; }
  cardError.setAttribute('aria-hidden','true'); cardError.textContent=''; return true;
}
function todayYMD(){ const d=new Date(); return { y:d.getFullYear(), m:d.getMonth()+1, day:d.getDate() }; }
function validateExpiry(){
  const v=(expInput.value||'').trim(); expError.setAttribute('aria-hidden','true'); expError.textContent='';
  if(!v) return false;
  if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(v)){ expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† MM/YY'; return false; }
  const [mm,yy]=v.split('/'); const year=2000+parseInt(yy,10); const month=parseInt(mm,10); const {y,m}=todayYMD();
  if(year<y || (year===y && month< m)){ expError.setAttribute('aria-hidden','false'); expError.textContent='Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.'; return false; }
  expError.setAttribute('aria-hidden','true'); expError.textContent=''; return true;
}
function validateCVV(){
  const cv = onlyDigits(cvvInput.value); const brand = state.brand;
  if(!cv){ cvvError.setAttribute('aria-hidden','true'); cvvError.textContent=''; return false; }
  if(brand === 'amex'){ if(cv.length !== 4){ cvvError.setAttribute('aria-hidden','false'); cvvError.textContent='Ø±Ù…Ø² Amex ÙŠØªÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù….'; return false; } }
  else { if(cv.length !==3){ cvvError.setAttribute('aria-hidden','false'); cvvError.textContent='CVV ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 3 Ø£Ø±Ù‚Ø§Ù….'; return false; } }
  cvvError.setAttribute('aria-hidden','true'); cvvError.textContent=''; return true;
}
function validateAll(){ const c = validateCardNumber(), e = validateExpiry(), v = validateCVV(); const all = c && e && v; submitBtn.disabled = !all; state.valid = all; return all; }

/* input handlers */
cardNumber.addEventListener('input', e=>{
  let raw = onlyDigits(e.target.value).slice(0,19);
  const brand = detectBrand(raw);
  e.target.value = formatGroups(raw,brand);
  setTimeout(()=> e.target.setSelectionRange(e.target.value.length, e.target.value.length),0);
  render();
});
cardNumber.addEventListener('paste', e=>{
  e.preventDefault();
  const txt = (e.clipboardData||window.clipboardData).getData('text');
  const digits = onlyDigits(txt).slice(0,19);
  if(!digits) return;
  cardNumber.value = formatGroups(digits, detectBrand(digits));
  render();
});
pasteBtn.addEventListener('click', async ()=>{
  try{ const txt = await navigator.clipboard.readText(); const digits = onlyDigits(txt).slice(0,19); if(!digits){ showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø§ÙØ¸Ø©'); return; } cardNumber.value = formatGroups(digits, detectBrand(digits)); render(); showToast('ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©'); } catch(err){ showToast('ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©'); console.error(err); }
});

expInput.addEventListener('input', e=>{ let v = onlyDigits(e.target.value).slice(0,4); if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2); e.target.value = v; render(); });
ownerInput.addEventListener('input', ()=>{ render(); markDirty(); });
cvvInput.addEventListener('input', e=>{ e.target.value = onlyDigits(e.target.value).slice(0,4); render(); });

/* NOTE: removed flipping behavior â€” CVV stays visible on front per request */

/* show/hide numbers */
showNumberBtn.addEventListener('click', ()=>{
  state.showNumber = !state.showNumber;
  showNumberBtn.setAttribute('aria-pressed', String(state.showNumber));
  showNumberBtn.textContent = state.showNumber ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
  render();
});

/* persist toggle */
persistToggle.addEventListener('change', (e)=>{
  state.persist = e.target.checked;
  if(state.persist){ saveFormToLocal(); showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§'); }
  else { localStorage.removeItem('demo_form'); showToast('ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ'); }
});

/* submit (simulated) */
document.getElementById('eligibilityForm').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  if(!validateAll()){ showToast('Ù…Ù† ÙØ¶Ù„Ùƒ ØµØ­Ù‘Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.'); return; }
  submitBtn.disabled = true; const prev = submitBtn.textContent; submitBtn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...';
  await new Promise(r=>setTimeout(r,900));
  showToast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© â€” (Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª)');
  submitBtn.textContent = prev; submitBtn.disabled = false;
  card.style && (card.style.boxShadow = '0 30px 80px rgba(16,185,129,.12)');
  setTimeout(()=>{ if(card && card.style) card.style.boxShadow=''; },1200);
  if(state.persist) saveFormToLocal();
});

/* local save/restore */
function saveFormToLocal(){ try{ const payload = { card: onlyDigits(cardNumber.value), owner: ownerInput.value||'', exp: expInput.value||'', cvv: cvvInput.value||'', brand: state.brand||null, dateSaved: new Date().toISOString() }; localStorage.setItem('demo_form', JSON.stringify(payload)); }catch(e){} }
function restoreFormFromLocal(){ try{ const raw = localStorage.getItem('demo_form'); if(!raw) return; const data = JSON.parse(raw); if(data.card) cardNumber.value = formatGroups(data.card, detectBrand(data.card)); ownerInput.value = data.owner||''; expInput.value = data.exp||''; cvvInput.value = data.cvv||''; render(); showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§'); }catch(e){} }
(function init(){
  const existing = localStorage.getItem('demo_form');
  if(existing){ persistToggle.checked = true; state.persist = true; restoreFormFromLocal(); }
  showNumberBtn.setAttribute('aria-pressed', String(state.showNumber));
  showNumberBtn.textContent = state.showNumber ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
  render();
})();

/* toast */
let toastTimeout = null;
function showToast(msg, ms=1600){ toast.textContent = msg; toast.style.display = 'block'; if(toastTimeout) clearTimeout(toastTimeout); toastTimeout = setTimeout(()=>{ toast.style.display = 'none'; toastTimeout = null; }, ms); }

/* keyboard submit */
[cardNumber, expInput, cvvInput, ownerInput].forEach(el=>{
  el && el.addEventListener('keydown', (ev)=>{
    if(ev.key === 'Enter'){ ev.preventDefault(); if(state.valid) document.getElementById('eligibilityForm').dispatchEvent(new Event('submit',{cancelable:true})); else { validateAll(); showToast('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); } }
  });
});

/* dirty guard */
let isDirty = false;
function markDirty(){ isDirty = true; }
['input','change'].forEach(evt=> document.getElementById('eligibilityForm').addEventListener(evt, ()=>{ isDirty = true; }));

window.addEventListener('beforeunload', (e)=>{ if(isDirty){ e.preventDefault(); e.returnValue=''; } });

/* init ARIA states */
cardError && cardError.setAttribute('aria-hidden','true');
expError && expError.setAttribute('aria-hidden','true');
cvvError && cvvError.setAttribute('aria-hidden','true');
</script>

</body>
</html>
